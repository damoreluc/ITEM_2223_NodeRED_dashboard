[
    {
        "id": "ce7acae890c807bf",
        "type": "tab",
        "label": "Test git",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "41c275d.65e1c8c",
        "type": "tab",
        "label": "Flow 1",
        "disabled": true,
        "info": ""
    },
    {
        "id": "1cd7cc33.b1cff4",
        "type": "tab",
        "label": "Esempi",
        "disabled": true,
        "info": ""
    },
    {
        "id": "ce09026f.e98f",
        "type": "tab",
        "label": "Split pacchetto",
        "disabled": true,
        "info": ""
    },
    {
        "id": "b511e93e.cbd928",
        "type": "tab",
        "label": "Flow 2",
        "disabled": true,
        "info": ""
    },
    {
        "id": "2ca7873.8485f78",
        "type": "tab",
        "label": "Flow 3",
        "disabled": true,
        "info": ""
    },
    {
        "id": "c47a0e17.12827",
        "type": "tab",
        "label": "BME280",
        "disabled": true,
        "info": ""
    },
    {
        "id": "3fa4d8c1.789b58",
        "type": "tab",
        "label": "Flow 4",
        "disabled": true,
        "info": ""
    },
    {
        "id": "c955b410.2b2588",
        "type": "tab",
        "label": "FFT",
        "disabled": true,
        "info": ""
    },
    {
        "id": "2566fba7.49e2e4",
        "type": "tab",
        "label": "Flow 5 FFT pacchetto",
        "disabled": true,
        "info": ""
    },
    {
        "id": "35e1e32f.937e74",
        "type": "tab",
        "label": "Demo 1: Static",
        "disabled": true,
        "info": ""
    },
    {
        "id": "5c66fca0.b4e21c",
        "type": "tab",
        "label": "Demo 2: dynamic",
        "disabled": true,
        "info": ""
    },
    {
        "id": "ed34b63.0ee70c8",
        "type": "tab",
        "label": "Demo 3: dynamic growing",
        "disabled": true,
        "info": ""
    },
    {
        "id": "559e4b7f.0a0044",
        "type": "tab",
        "label": "Flow 8",
        "disabled": true,
        "info": ""
    },
    {
        "id": "5f07f6ab.6224a8",
        "type": "tab",
        "label": "Flow 5",
        "disabled": true,
        "info": ""
    },
    {
        "id": "1dfbd57d.bb713b",
        "type": "tab",
        "label": "ESP32_LEDCPWM",
        "disabled": true,
        "info": ""
    },
    {
        "id": "461168f8.e247f8",
        "type": "tab",
        "label": "MultiPacket_FFT",
        "disabled": true,
        "info": "Assembla 4 payload consecutivi per ottenere un unico pacchetto.\n\nDa usare con ESP32 programmata col sorgente:\n\nESP32 DevKit Async MQTT big packet Planet02\n\n(Test ESP32-WROOM-32 DevKit Async MQTT client v2.0 with big packet)\n\nRef:\nhttps://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\nhttps://stackoverflow.com/questions/8609289/convert-a-binary-nodejs-buffer-to-javascript-arraybuffer\nhttps://www.w3schools.com/ai/ai_chartjs.asp"
    },
    {
        "id": "24046517.06b45a",
        "type": "tab",
        "label": "MultiPacket_scope_FFT_01",
        "disabled": true,
        "info": "Assembla 4 payload consecutivi per ottenere un unico pacchetto.\n\nDa usare con ESP32 programmata col sorgente:\n\nESP32 DevKit Async MQTT big packet Planet02\n\n(Test ESP32-WROOM-32 DevKit Async MQTT client v2.0 with big packet)\n\nRef:\nhttps://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\nhttps://stackoverflow.com/questions/8609289/convert-a-binary-nodejs-buffer-to-javascript-arraybuffer\nhttps://www.w3schools.com/ai/ai_chartjs.asp\n\n// aggiornamento dataset del grafico:\nhttps://www.chartjs.org/docs/latest/developers/updates.html"
    },
    {
        "id": "1471bcf322cb6423",
        "type": "tab",
        "label": "MultiPacket_scope_FFT",
        "disabled": false,
        "info": "Assembla 4 payload consecutivi per ottenere un unico pacchetto.\n\nDa usare con ESP32 programmata col sorgente:\n\nESP32 DevKit Async MQTT big packet Planet02\n\n(Test ESP32-WROOM-32 DevKit Async MQTT client v2.0 with big packet)\n\nRef:\nhttps://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\nhttps://stackoverflow.com/questions/8609289/convert-a-binary-nodejs-buffer-to-javascript-arraybuffer\nhttps://www.w3schools.com/ai/ai_chartjs.asp\n\n// aggiornamento dataset del grafico:\nhttps://www.chartjs.org/docs/latest/developers/updates.html"
    },
    {
        "id": "6c259dd5.72f0d4",
        "type": "subflow",
        "name": "Ring Buffer",
        "info": "# Ring buffer\n## Last in First Out subflow\nThis flow receives a series of msg.payloads and builds a ring bifferwith a specific buffer size. The buffer size is configurabe through subflows enviroment variables.\n\n### Input\nThe `msg.payload`will be added to the ring buffer array, except if `msg.topic == list`\n\nIf `msg.topic == list` the complete buffer will be sent at the secont output.\n\n\n### Output 1\nAlways sends the original message\n\n### Output 2\nAlways return the complete buffer.\n\n### Status\nAlways shows the queue size.\n\n### Enviroment Variables\n`Buffer_Size` defines the size of the queue. If a new item arrives and the queue is full, the oldest item will be removed.",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 100,
                "wires": [
                    {
                        "id": "b4286eb1.847af"
                    },
                    {
                        "id": "36df5ea7.231082"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 280,
                "y": 40,
                "wires": [
                    {
                        "id": "6c259dd5.72f0d4",
                        "port": 0
                    }
                ]
            },
            {
                "x": 800,
                "y": 140,
                "wires": [
                    {
                        "id": "afc05e2d.59f36",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "Buffer_Size",
                "type": "num",
                "value": "128",
                "ui": {
                    "type": "input",
                    "opts": {
                        "types": [
                            "num",
                            "env"
                        ]
                    }
                }
            },
            {
                "name": "Buffer_Reset",
                "type": "bool",
                "value": "false"
            }
        ],
        "color": "#DDAA99",
        "inputLabels": [
            "payload"
        ],
        "outputLabels": [
            "Original message",
            "Buffer"
        ],
        "icon": "font-awesome/fa-circle-o-notch",
        "status": {
            "x": 1020,
            "y": 100,
            "wires": [
                {
                    "id": "36df5ea7.231082",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "d3ab5b4c.55d338",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "c2d55a4c.f19eb8",
        "type": "ui_tab",
        "name": "Main",
        "icon": "dashboard",
        "order": 1,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "63897fa5.43c4",
        "type": "ui_group",
        "name": "Uno",
        "tab": "c2d55a4c.f19eb8",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "26077238.d6034e",
        "type": "mqtt-broker",
        "name": "Raspberry Pi4",
        "broker": "192.168.0.46",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": false,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "b9eb0937.738868",
        "type": "ui_group",
        "name": "Due",
        "tab": "c2d55a4c.f19eb8",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "a54f994b.fa7e08",
        "type": "ui_group",
        "name": "Time stamp",
        "tab": "b1a0646f.e60998",
        "order": 1,
        "disp": true,
        "width": "16",
        "collapse": false
    },
    {
        "id": "35679e61.aa8e72",
        "type": "ui_group",
        "name": "Temperature",
        "tab": "b1a0646f.e60998",
        "order": 2,
        "disp": true,
        "width": "16",
        "collapse": false
    },
    {
        "id": "1908f510.6d260b",
        "type": "ui_group",
        "name": "A3_A4",
        "tab": "b1a0646f.e60998",
        "order": 3,
        "disp": true,
        "width": "16",
        "collapse": false
    },
    {
        "id": "cfc49afe.f8d588",
        "type": "ui_group",
        "name": "A5_A6",
        "tab": "b1a0646f.e60998",
        "order": 4,
        "disp": true,
        "width": "16",
        "collapse": false
    },
    {
        "id": "b1a0646f.e60998",
        "type": "ui_tab",
        "name": "Planet_01",
        "icon": "dashboard",
        "order": 4,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "d220cbeb.3f2478",
        "type": "mqtt-broker",
        "name": "Mosquitto",
        "broker": "test.mosquitto.org",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": false,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "7f0dc9b.56d0038",
        "type": "mqtt-broker",
        "name": "SHIFTR.IO",
        "broker": "item2122a.cloud.shiftr.io",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": false,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "5281f4aa.e927ac",
        "type": "mqtt-broker",
        "name": "Udoo",
        "broker": "192.168.0.48",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": true,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "26a30331.bcf2dc",
        "type": "mqtt-broker",
        "name": "ESP32_FFT",
        "broker": "192.168.0.64",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "compatmode": false,
        "protocolVersion": 4,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "21fb4565.85565a",
        "type": "ui_group",
        "name": "demo 1",
        "tab": "a4054538.f69598",
        "order": 1,
        "disp": false,
        "width": "12",
        "collapse": false
    },
    {
        "id": "a4054538.f69598",
        "type": "ui_tab",
        "name": "Demo 1:  static",
        "icon": "dashboard",
        "order": 1
    },
    {
        "id": "62e84868.707968",
        "type": "ui_tab",
        "name": "Demo 3: dynamic growing",
        "icon": "dashboard",
        "order": 3
    },
    {
        "id": "ed68b86d.026b2",
        "type": "ui_group",
        "name": "demo 3",
        "tab": "62e84868.707968",
        "order": 1,
        "disp": false,
        "width": "12",
        "collapse": false
    },
    {
        "id": "5d771aac.b2fbac",
        "type": "ui_tab",
        "name": "Demo 2: dynamic",
        "icon": "dashboard",
        "order": 2
    },
    {
        "id": "a1a4b9da.737a38",
        "type": "ui_group",
        "name": "demo 2",
        "tab": "5d771aac.b2fbac",
        "order": 1,
        "disp": false,
        "width": "12",
        "collapse": false
    },
    {
        "id": "5e654364.60838c",
        "type": "ui_tab",
        "name": "FFT",
        "icon": "dashboard",
        "order": 6,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "2bf41b72.1ddbf4",
        "type": "ui_group",
        "name": "Segnale",
        "tab": "5e654364.60838c",
        "order": 1,
        "disp": true,
        "width": "20",
        "collapse": false
    },
    {
        "id": "ed4f6f2d.cb71d",
        "type": "ui_group",
        "name": "Led PWM",
        "tab": "c2d55a4c.f19eb8",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "1b44d85b.ff3588",
        "type": "mqtt-broker",
        "name": "Raspberry Pi4",
        "broker": "192.168.0.46",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": false,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "b03b962e.7c4d18",
        "type": "ui_group",
        "name": "Dati",
        "tab": "579ad216.e7ee9c",
        "order": 1,
        "disp": true,
        "width": "16",
        "collapse": false
    },
    {
        "id": "579ad216.e7ee9c",
        "type": "ui_tab",
        "name": "binary_old",
        "icon": "dashboard",
        "order": 7,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "e17896f2.80a5d",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 4,
        "width": 2,
        "height": 1
    },
    {
        "id": "fd385d7b.f6eb",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 5,
        "width": 2,
        "height": 1
    },
    {
        "id": "a99a72c8.822928",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 6,
        "width": 2,
        "height": 1
    },
    {
        "id": "6fc54d4d.ec2284",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 7,
        "width": 2,
        "height": 1
    },
    {
        "id": "2b3220bb.4ab43",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 8,
        "width": 2,
        "height": 1
    },
    {
        "id": "69ef70e4.065f2",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 9,
        "width": 2,
        "height": 1
    },
    {
        "id": "a4ba43a8.5863e8",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 11,
        "width": 1,
        "height": 1
    },
    {
        "id": "ca168191.d5201",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 13,
        "width": 1,
        "height": 1
    },
    {
        "id": "ba799040.74269",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 15,
        "width": 2,
        "height": 1
    },
    {
        "id": "9a700e17.07f14",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 17,
        "width": 2,
        "height": 1
    },
    {
        "id": "35a4e7d1.620608",
        "type": "mqtt-broker",
        "name": "Shiftr",
        "broker": "item2122a.cloud.shiftr.io",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "compatmode": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "a44738b2662f42c6",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 5,
        "width": 2,
        "height": 1
    },
    {
        "id": "85f22695862cd41e",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 6,
        "width": 2,
        "height": 1
    },
    {
        "id": "969ebaf977a2287b",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 8,
        "width": 2,
        "height": 1
    },
    {
        "id": "4266b148b3c19218",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 9,
        "width": 2,
        "height": 1
    },
    {
        "id": "79f08c1b172df01e",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 10,
        "width": 2,
        "height": 1
    },
    {
        "id": "cfcff6a74151fea0",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 12,
        "width": 10,
        "height": 1
    },
    {
        "id": "3cce898b5161dcf7",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 13,
        "width": 1,
        "height": 1
    },
    {
        "id": "a6851369ae22d014",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 15,
        "width": 1,
        "height": 1
    },
    {
        "id": "16bc25db873124e1",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 17,
        "width": 1,
        "height": 1
    },
    {
        "id": "262f7f788d5d4a2f",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 19,
        "width": 1,
        "height": 1
    },
    {
        "id": "1d614804986e2038",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 20,
        "width": 1,
        "height": 1
    },
    {
        "id": "3bb368b604a3d1ac",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "b03b962e.7c4d18",
        "order": 24,
        "width": 1,
        "height": 1
    },
    {
        "id": "91b2126d552ea04a",
        "type": "ui_tab",
        "name": "ITEM_2021_2022",
        "icon": "dashboard",
        "order": 8,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "5f88817443cb3d4b",
        "type": "ui_group",
        "name": "Dati",
        "tab": "91b2126d552ea04a",
        "order": 1,
        "disp": true,
        "width": "24",
        "collapse": false,
        "className": ""
    },
    {
        "id": "67fc408ff878f115",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "5f88817443cb3d4b",
        "order": 5,
        "width": 2,
        "height": 1
    },
    {
        "id": "c4c3adb2e9ed6c74",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "5f88817443cb3d4b",
        "order": 6,
        "width": 2,
        "height": 1
    },
    {
        "id": "e72665a83258061f",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "5f88817443cb3d4b",
        "order": 8,
        "width": 2,
        "height": 1
    },
    {
        "id": "a834e40fb32b62e7",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "5f88817443cb3d4b",
        "order": 9,
        "width": 2,
        "height": 1
    },
    {
        "id": "4a335ee41d76d48e",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "5f88817443cb3d4b",
        "order": 10,
        "width": 2,
        "height": 1
    },
    {
        "id": "808222c98d761212",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "5f88817443cb3d4b",
        "order": 12,
        "width": 10,
        "height": 1
    },
    {
        "id": "8dea25cf2301c6a9",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "5f88817443cb3d4b",
        "order": 13,
        "width": 1,
        "height": 1
    },
    {
        "id": "5145d99ca774736f",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "5f88817443cb3d4b",
        "order": 15,
        "width": 1,
        "height": 1
    },
    {
        "id": "3386140272dba19a",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "5f88817443cb3d4b",
        "order": 17,
        "width": 1,
        "height": 1
    },
    {
        "id": "cd68a9c4fc2c3b19",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "5f88817443cb3d4b",
        "order": 19,
        "width": 1,
        "height": 1
    },
    {
        "id": "97a242b138f3bfa8",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "5f88817443cb3d4b",
        "order": 20,
        "width": 1,
        "height": 1
    },
    {
        "id": "d85b0824a29ad4cb",
        "type": "ui_spacer",
        "z": "1471bcf322cb6423",
        "name": "spacer",
        "group": "5f88817443cb3d4b",
        "order": 24,
        "width": 1,
        "height": 1
    },
    {
        "id": "b4286eb1.847af",
        "type": "switch",
        "z": "6c259dd5.72f0d4",
        "name": "Topic",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "list",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 310,
        "y": 100,
        "wires": [
            [
                "6c6b3594.fac22c"
            ],
            [
                "afc05e2d.59f36"
            ]
        ]
    },
    {
        "id": "afc05e2d.59f36",
        "type": "function",
        "z": "6c259dd5.72f0d4",
        "name": "put",
        "func": "var queue = flow.get(\"queue\");\n//var queue = context.get(\"queue\");\n\nvar bufferSize = parseInt(env.get(\"Buffer_Size\"));\n\nif (!Array.isArray(queue)){\n    queue = [];\n//}else if ( queue.length >= env.get(\"Buffer_Size\") ){\n}else if ( queue.length >= bufferSize ){    \n//    queue.pop(1);\n    queue = [];\n}\n\nif(msg.topic==\"ResetQueue\") {\n    queue = [];\n    flow.set(\"queue\", queue);\n    //context.set(\"queue\", queue);    \n} \nelse {\n//queue.unshift(msg.payload);\nqueue.push(msg.payload);\n\nflow.set(\"queue\", queue);\n//context.set(\"queue\", queue);\n\n//msg.payload = queue;\n\n//if ( queue.length == env.get(\"Buffer_Size\") ){\nif ( queue.length == bufferSize ){\n  msg.payload = queue;\n  queue = [];\n} else {\n    msg.payload=null;\n}\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 490,
        "y": 140,
        "wires": [
            [
                "6c6b3594.fac22c"
            ]
        ]
    },
    {
        "id": "6c6b3594.fac22c",
        "type": "change",
        "z": "6c259dd5.72f0d4",
        "name": "list",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "queue",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "36df5ea7.231082",
        "type": "change",
        "z": "6c259dd5.72f0d4",
        "name": "Count",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$count(msg.payload)\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 890,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "54c23b2587c2e21e",
        "type": "inject",
        "z": "ce7acae890c807bf",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 220,
        "y": 120,
        "wires": [
            [
                "44c3ee26ba3f23e5"
            ]
        ]
    },
    {
        "id": "44c3ee26ba3f23e5",
        "type": "debug",
        "z": "ce7acae890c807bf",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 440,
        "y": 120,
        "wires": []
    },
    {
        "id": "d2913b58.341888",
        "type": "inject",
        "z": "41c275d.65e1c8c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 140,
        "wires": [
            [
                "6a379584.e6e30c"
            ]
        ]
    },
    {
        "id": "6a379584.e6e30c",
        "type": "debug",
        "z": "41c275d.65e1c8c",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 450,
        "y": 140,
        "wires": []
    },
    {
        "id": "a5c4e1b8.57914",
        "type": "ui_slider",
        "z": "41c275d.65e1c8c",
        "name": "Potenziometro",
        "label": "Potenziometro",
        "tooltip": "",
        "group": "63897fa5.43c4",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "all",
        "topic": "topic",
        "topicType": "msg",
        "min": 0,
        "max": 10,
        "step": 1,
        "x": 150,
        "y": 280,
        "wires": [
            [
                "690f82ae.a560dc"
            ]
        ]
    },
    {
        "id": "690f82ae.a560dc",
        "type": "ui_gauge",
        "z": "41c275d.65e1c8c",
        "name": "Multimetro",
        "group": "63897fa5.43c4",
        "order": 1,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Multimetro",
        "label": "Volt",
        "format": "{{value}}",
        "min": 0,
        "max": 10,
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 450,
        "y": 280,
        "wires": []
    },
    {
        "id": "f8618435.59e518",
        "type": "mqtt out",
        "z": "41c275d.65e1c8c",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "26077238.d6034e",
        "x": 300,
        "y": 440,
        "wires": []
    },
    {
        "id": "e311195e.2b20b8",
        "type": "mqtt in",
        "z": "41c275d.65e1c8c",
        "name": "",
        "topic": "slider",
        "qos": "2",
        "datatype": "auto",
        "broker": "26077238.d6034e",
        "inputs": 0,
        "x": 510,
        "y": 440,
        "wires": [
            [
                "f32785d.d12c178"
            ]
        ]
    },
    {
        "id": "a7fdeec.e6b9a1",
        "type": "ui_slider",
        "z": "41c275d.65e1c8c",
        "name": "",
        "label": "slider MQTT",
        "tooltip": "",
        "group": "63897fa5.43c4",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "all",
        "topic": "slider",
        "topicType": "str",
        "min": 0,
        "max": 10,
        "step": 1,
        "x": 130,
        "y": 340,
        "wires": [
            [
                "f8618435.59e518"
            ]
        ]
    },
    {
        "id": "f32785d.d12c178",
        "type": "ui_gauge",
        "z": "41c275d.65e1c8c",
        "name": "",
        "group": "63897fa5.43c4",
        "order": 3,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "gauge MQTT",
        "label": "units",
        "format": "{{value}}",
        "min": 0,
        "max": 10,
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 680,
        "y": 440,
        "wires": []
    },
    {
        "id": "bf43ab61.c0c658",
        "type": "debug",
        "z": "41c275d.65e1c8c",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 730,
        "y": 500,
        "wires": []
    },
    {
        "id": "506675a8.b0efac",
        "type": "ui_led",
        "z": "41c275d.65e1c8c",
        "order": 1,
        "group": "b9eb0937.738868",
        "width": 0,
        "height": 0,
        "label": "Off/On",
        "labelPlacement": "left",
        "labelAlignment": "left",
        "colorForValue": [
            {
                "color": "#ff0000",
                "value": "false",
                "valueType": "str"
            },
            {
                "color": "#008000",
                "value": "true",
                "valueType": "str"
            }
        ],
        "allowColorForValueInMessage": false,
        "shape": "circle",
        "showGlow": true,
        "name": "OnOff",
        "x": 710,
        "y": 540,
        "wires": []
    },
    {
        "id": "6c630306.e5fe4c",
        "type": "mqtt in",
        "z": "41c275d.65e1c8c",
        "name": "",
        "topic": "SwitchOnOff",
        "qos": "0",
        "datatype": "auto",
        "broker": "26077238.d6034e",
        "inputs": 0,
        "x": 540,
        "y": 540,
        "wires": [
            [
                "506675a8.b0efac",
                "bf43ab61.c0c658"
            ]
        ]
    },
    {
        "id": "ce4bc177.97c",
        "type": "ui_switch",
        "z": "41c275d.65e1c8c",
        "name": "",
        "label": "Off/On",
        "tooltip": "",
        "group": "b9eb0937.738868",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "SwitchOnOff",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "x": 140,
        "y": 540,
        "wires": [
            [
                "f8618435.59e518"
            ]
        ]
    },
    {
        "id": "b58356cc.d9bae8",
        "type": "inject",
        "z": "1cd7cc33.b1cff4",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "esempio 1",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 100,
        "wires": [
            [
                "21db871b.eeca58"
            ]
        ]
    },
    {
        "id": "86476e24.70a18",
        "type": "comment",
        "z": "1cd7cc33.b1cff4",
        "name": "Semplice function",
        "info": "",
        "x": 120,
        "y": 40,
        "wires": []
    },
    {
        "id": "21db871b.eeca58",
        "type": "function",
        "z": "1cd7cc33.b1cff4",
        "name": "DataInStringa",
        "func": "// crea una data a partire dal timestamp \n// contenuto nel payload del messaggio\nvar date = new Date(msg.payload);\n// sostituisce il payload con la data, in formato testo\nmsg.payload = date.toString();\n// restituisce il messaggio in uscita\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 370,
        "y": 100,
        "wires": [
            [
                "1a90f9fe.1f4306"
            ]
        ]
    },
    {
        "id": "1a90f9fe.1f4306",
        "type": "debug",
        "z": "1cd7cc33.b1cff4",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 550,
        "y": 100,
        "wires": []
    },
    {
        "id": "f0863303.f2ecc",
        "type": "comment",
        "z": "1cd7cc33.b1cff4",
        "name": "Terremoti con magnitudo >=7...",
        "info": "",
        "x": 170,
        "y": 240,
        "wires": []
    },
    {
        "id": "76ad9c96.c63054",
        "type": "inject",
        "z": "1cd7cc33.b1cff4",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "300",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 300,
        "wires": [
            [
                "146d070c.c4aed9"
            ]
        ]
    },
    {
        "id": "146d070c.c4aed9",
        "type": "http request",
        "z": "1cd7cc33.b1cff4",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/significant_month.csv",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 330,
        "y": 300,
        "wires": [
            [
                "522c428c.05041c"
            ]
        ]
    },
    {
        "id": "522c428c.05041c",
        "type": "csv",
        "z": "1cd7cc33.b1cff4",
        "name": "",
        "sep": ",",
        "hdrin": true,
        "hdrout": "none",
        "multi": "one",
        "ret": "\\n",
        "temp": "",
        "skip": "0",
        "strings": true,
        "include_empty_strings": "",
        "include_null_values": "",
        "x": 510,
        "y": 300,
        "wires": [
            [
                "e963b254.9af73",
                "11bbacd2.9a86d3"
            ]
        ]
    },
    {
        "id": "e963b254.9af73",
        "type": "debug",
        "z": "1cd7cc33.b1cff4",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 680,
        "y": 300,
        "wires": []
    },
    {
        "id": "11bbacd2.9a86d3",
        "type": "switch",
        "z": "1cd7cc33.b1cff4",
        "name": "",
        "property": "payload.mag",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gte",
                "v": "7",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 680,
        "y": 400,
        "wires": [
            [
                "7aa66b96.f68224"
            ]
        ]
    },
    {
        "id": "7aa66b96.f68224",
        "type": "debug",
        "z": "1cd7cc33.b1cff4",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 840,
        "y": 400,
        "wires": []
    },
    {
        "id": "ba7cd94c.efc0f8",
        "type": "function",
        "z": "ce09026f.e98f",
        "name": "split pacchetto",
        "func": "var s = msg.payload;\n\n// stringa di prova\n//var s=\"@;0001051048;00869;00426;02420;00472;00000;01234\";\n// array con le parti di s\nvar o = s.split(\";\");\n// array di uscita\nvar a=[];\n\n// nomi dei topics\n//          o = [@, 0001208869, 00000, 00000, 00573,... ];\nvar topicName = [\"header\",\"timestamp\",\"A1\",\"A2\",\"A3\",\"A4\",\"A5\",\"A6\"];\n\n// ciclo di creazione delle uscite\nvar i;\nfor(i=1; i < topicName.length; i++) {\n    t = topicName[i];\n    //v = values[i];\n    v=parseInt(o[i]);\n    a.push({\"topic\":t,\"payload\":v});\n    //node.warn({\"topic\":t,\"payload\":v});\n}\n//node.warn(a);\nreturn a;",
        "outputs": 7,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 300,
        "y": 160,
        "wires": [
            [
                "501dbe1f.92a7",
                "86edcd92.88cb8"
            ],
            [
                "c19a8d22.b128c"
            ],
            [
                "c3669804.c0b7e8"
            ],
            [
                "79af1cf8.a5bc04"
            ],
            [
                "ed5421c9.f9c8a"
            ],
            [
                "53edc71f.ac6d98"
            ],
            [
                "d760c67e.4120c8"
            ]
        ]
    },
    {
        "id": "6d25680b.8577e8",
        "type": "inject",
        "z": "ce09026f.e98f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "remote/",
        "payload": "@;0001051053;00869;00426;02420;00472;00000;01234",
        "payloadType": "str",
        "x": 110,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "32499bca.ee38d4",
        "type": "comment",
        "z": "ce09026f.e98f",
        "name": "split ed array con for",
        "info": "",
        "x": 290,
        "y": 80,
        "wires": []
    },
    {
        "id": "501dbe1f.92a7",
        "type": "ui_text",
        "z": "ce09026f.e98f",
        "group": "a54f994b.fa7e08",
        "order": 0,
        "width": "2",
        "height": "1",
        "name": "",
        "label": "Time stamp",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "x": 790,
        "y": 80,
        "wires": []
    },
    {
        "id": "be7ac6.d41dd538",
        "type": "ui_gauge",
        "z": "ce09026f.e98f",
        "name": "",
        "group": "35679e61.aa8e72",
        "order": 1,
        "width": "4",
        "height": "3",
        "gtype": "gage",
        "title": "A1",
        "label": "[Â°C]",
        "format": "{{value | number:2}}",
        "min": 0,
        "max": "150",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 770,
        "y": 140,
        "wires": []
    },
    {
        "id": "c19a8d22.b128c",
        "type": "function",
        "z": "ce09026f.e98f",
        "name": "TMP36",
        "func": "// parametri TMP36\nvar Vofs = 0.5;  // volt\nvar k = 0.01;    // 10mV / Â°C\nvar Vref = 3.3;  // volt\n\nvar n = msg.payload;\n// ricavo tensione\nvar v = n * Vref / 4096.0;\n// ricavo temperatura\nmsg.payload = (v-Vofs)/k;\nmsg.topic = \"Temperatura 1\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 580,
        "y": 140,
        "wires": [
            [
                "be7ac6.d41dd538",
                "86edcd92.88cb8",
                "c9339f80.5587e"
            ]
        ],
        "info": "# TMP36\nconversione da intero (fondo scala 4095) a Â°C nell'intervallo 0Â°C .. 150Â°C"
    },
    {
        "id": "c3669804.c0b7e8",
        "type": "function",
        "z": "ce09026f.e98f",
        "name": "TMP36",
        "func": "// parametri TMP36\nvar Vofs = 0.5;  // volt\nvar k = 0.01;    // 10mV / Â°C\nvar Vref = 3.3;  // volt\n\nvar n = msg.payload;\n// ricavo tensione\nvar v = n * Vref / 4096.0;\n// ricavo temperatura\nmsg.payload = (v-Vofs)/k;\nmsg.topic = \"Temperatura 2\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 580,
        "y": 180,
        "wires": [
            [
                "c6c63388.ad899",
                "86edcd92.88cb8",
                "c9339f80.5587e"
            ]
        ],
        "info": "# TMP36\nconversione da intero (fondo scala 4095) a Â°C nell'intervallo 0Â°C .. 150Â°C"
    },
    {
        "id": "c6c63388.ad899",
        "type": "ui_gauge",
        "z": "ce09026f.e98f",
        "name": "",
        "group": "35679e61.aa8e72",
        "order": 2,
        "width": "4",
        "height": "3",
        "gtype": "gage",
        "title": "A2",
        "label": "[Â°C]",
        "format": "{{value | number:2}}",
        "min": 0,
        "max": "150",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 770,
        "y": 180,
        "wires": []
    },
    {
        "id": "79af1cf8.a5bc04",
        "type": "function",
        "z": "ce09026f.e98f",
        "name": "ADXL335_X",
        "func": "// parametri ADXL335 asse X\nvar Vofsx = 1.638;   // volt\nvar kx = 0.33;      // typ. 300mV / g\nvar Vref = 3.3;     // volt\n\nvar n = msg.payload;\n// ricavo tensione\nvar v = n * Vref / 4096.0;\n// ricavo l'accelerazione \nmsg.payload = (v-Vofsx)/kx;\nmsg.topic = \"Asse x\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 590,
        "y": 220,
        "wires": [
            [
                "7008b79f.5385c8",
                "86edcd92.88cb8",
                "88ba9951.2045a8"
            ]
        ],
        "info": "# TMP36\nconversione da intero (fondo scala 4095) a Â°C nell'intervallo 0Â°C .. 150Â°C"
    },
    {
        "id": "7008b79f.5385c8",
        "type": "ui_gauge",
        "z": "ce09026f.e98f",
        "name": "",
        "group": "1908f510.6d260b",
        "order": 1,
        "width": "4",
        "height": "3",
        "gtype": "gage",
        "title": "A3",
        "label": "[g]",
        "format": "{{value | number:2}}",
        "min": "-3.0",
        "max": "+3.0",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 770,
        "y": 220,
        "wires": []
    },
    {
        "id": "ed5421c9.f9c8a",
        "type": "function",
        "z": "ce09026f.e98f",
        "name": "ADXL335_Y",
        "func": "// parametri ADXL335 asse Y\nvar Vofsy = 1.65;   // volt\nvar ky = 0.33;       // typ. 300mV / g\nvar Vref = 3.3;     // volt\n\nvar n = msg.payload;\n// ricavo tensione\nvar v = n * Vref / 4096.0;\n// ricavo l'accelerazione \nmsg.payload = (v-Vofsy)/ky;\nmsg.topic = \"Asse y\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 590,
        "y": 260,
        "wires": [
            [
                "3139a559.99c18a",
                "86edcd92.88cb8"
            ]
        ],
        "info": "# TMP36\nconversione da intero (fondo scala 4095) a Â°C nell'intervallo 0Â°C .. 150Â°C"
    },
    {
        "id": "3139a559.99c18a",
        "type": "ui_gauge",
        "z": "ce09026f.e98f",
        "name": "",
        "group": "1908f510.6d260b",
        "order": 2,
        "width": "4",
        "height": "3",
        "gtype": "gage",
        "title": "A4",
        "label": "[g]",
        "format": "{{value | number:2}}",
        "min": "-3.0",
        "max": "+3.0",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 770,
        "y": 260,
        "wires": []
    },
    {
        "id": "53edc71f.ac6d98",
        "type": "function",
        "z": "ce09026f.e98f",
        "name": "ADXL335_Z",
        "func": "// parametri ADXL335 asse Z\nvar Vofsz = 1.6495;   // volt\nvar kz = 0.33;       // typ. 300mV / g\nvar Vref = 3.3;     // volt\n\nvar n = msg.payload;\n// ricavo tensione\nvar v = n * Vref / 4096.0;\n// ricavo l'accelerazione \nmsg.payload = (v-Vofsz)/kz;\nmsg.topic = \"Asse z\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 590,
        "y": 300,
        "wires": [
            [
                "bb8135b2.ef4bd8",
                "86edcd92.88cb8"
            ]
        ],
        "info": "# TMP36\nconversione da intero (fondo scala 4095) a Â°C nell'intervallo 0Â°C .. 150Â°C"
    },
    {
        "id": "bb8135b2.ef4bd8",
        "type": "ui_gauge",
        "z": "ce09026f.e98f",
        "name": "",
        "group": "cfc49afe.f8d588",
        "order": 1,
        "width": "4",
        "height": "3",
        "gtype": "gage",
        "title": "A5",
        "label": "[g]",
        "format": "{{value | number:2}}",
        "min": "-3.0",
        "max": "+3.0",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 770,
        "y": 300,
        "wires": []
    },
    {
        "id": "d760c67e.4120c8",
        "type": "function",
        "z": "ce09026f.e98f",
        "name": "Coppia",
        "func": "// parametri trasduttore coppia\nvar Vofs = 1.65;   // volt\nvar k = 10/1.65;   // -10/+10\nvar Vref = 3.3;    // volt\n\nvar n = msg.payload;\n// ricavo tensione\nvar v = n * Vref / 4096.0;\n// ricavo l'accelerazione \nmsg.payload = (v-Vofs)*k;\nmsg.topic = \"Coppia\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 580,
        "y": 340,
        "wires": [
            [
                "de82d964.e7b6f8",
                "86edcd92.88cb8"
            ]
        ],
        "info": "# TMP36\nconversione da intero (fondo scala 4095) a Â°C nell'intervallo 0Â°C .. 150Â°C"
    },
    {
        "id": "de82d964.e7b6f8",
        "type": "ui_gauge",
        "z": "ce09026f.e98f",
        "name": "",
        "group": "cfc49afe.f8d588",
        "order": 2,
        "width": "4",
        "height": "3",
        "gtype": "gage",
        "title": "A6",
        "label": "[V]",
        "format": "{{value | number:2}}",
        "min": "-10",
        "max": "+10",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 770,
        "y": 340,
        "wires": []
    },
    {
        "id": "ecc46bca.601bb8",
        "type": "ui_chart",
        "z": "ce09026f.e98f",
        "name": "",
        "group": "35679e61.aa8e72",
        "order": 4,
        "width": "8",
        "height": "6",
        "label": "chart",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "40",
        "removeOlder": "10",
        "removeOlderPoints": "100",
        "removeOlderUnit": "1",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "x": 1130,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "f5eea78f.5a29c8",
        "type": "ui_chart",
        "z": "ce09026f.e98f",
        "name": "",
        "group": "1908f510.6d260b",
        "order": 3,
        "width": "8",
        "height": "6",
        "label": "chart",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "-4",
        "ymax": "+4",
        "removeOlder": "10",
        "removeOlderPoints": "100",
        "removeOlderUnit": "1",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "x": 1170,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "a0781373.052f2",
        "type": "ui_chart",
        "z": "ce09026f.e98f",
        "name": "",
        "group": "cfc49afe.f8d588",
        "order": 3,
        "width": "8",
        "height": "6",
        "label": "chart",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "-10",
        "ymax": "10",
        "removeOlder": "2",
        "removeOlderPoints": "100",
        "removeOlderUnit": "1",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "x": 970,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "6a764480.573e7c",
        "type": "mqtt in",
        "z": "ce09026f.e98f",
        "name": "",
        "topic": "ESP32DevKit123/outTopic10",
        "qos": "2",
        "datatype": "auto",
        "broker": "d220cbeb.3f2478",
        "inputs": 0,
        "x": 170,
        "y": 520,
        "wires": [
            [
                "cb23da81.886f48"
            ]
        ]
    },
    {
        "id": "66f0f75a.969998",
        "type": "ui_switch",
        "z": "ce09026f.e98f",
        "name": "",
        "label": "Led",
        "tooltip": "",
        "group": "a54f994b.fa7e08",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "true",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "x": 90,
        "y": 580,
        "wires": [
            [
                "c81fab89.6a1e38"
            ]
        ]
    },
    {
        "id": "c81fab89.6a1e38",
        "type": "mqtt out",
        "z": "ce09026f.e98f",
        "name": "Led",
        "topic": "ESP32DevKit123/ledTopic",
        "qos": "2",
        "retain": "",
        "broker": "d220cbeb.3f2478",
        "x": 280,
        "y": 580,
        "wires": []
    },
    {
        "id": "f603b10d.27b7b",
        "type": "debug",
        "z": "ce09026f.e98f",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 570,
        "y": 840,
        "wires": []
    },
    {
        "id": "86edcd92.88cb8",
        "type": "join",
        "z": "ce09026f.e98f",
        "name": "",
        "mode": "custom",
        "build": "array",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "7",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "num",
        "reduceFixup": "",
        "x": 790,
        "y": 460,
        "wires": [
            [
                "10595e71.7a83c2"
            ]
        ]
    },
    {
        "id": "225b4943.0d7cd6",
        "type": "function",
        "z": "ce09026f.e98f",
        "name": "Filename generator",
        "func": "// path to log files\nvar logPath = \"/home/dietpi/datalog/\";\n\n// get current time and date and convert it to text\nvar now = new Date();\nvar yyyy = now.getFullYear();\nvar mm = (now.getMonth() < 9) ? \"0\" + (now.getMonth() +1) : (now.getMonth() +1);  // getMonth is zero-based\nvar dd = (now.getDate() < 10) ? \"0\" + now.getDate() : now.getDate();\nvar hh = (now.getHours() < 10) ? \"0\" + now.getHours() : now.getHours();\nvar mmm = (now.getMinutes() < 10) ? \"0\" + now.getMinutes() : now.getMinutes();\nvar ss = (now.getSeconds() < 10) ? \"0\" + now.getSeconds() : now.getSeconds();\n\n// generate out file name pattern\nmsg.fname = \"planet_\" + yyyy + mm + dd + \".csv\";\n// full filename with the path for the file node\nmsg.filename = logPath + msg.fname;\n\n// save the current payload into a different place on the msg object\nmsg.filecontent = msg.payload;\n\n// pass the file name as search pattern to fs node to tell us if the file exists or not\nmsg.payload = {\"start\": logPath, \"pattern\": msg.fname};\n\nnode.status({fill: \"blue\", shape: \"ring\", text: msg.filename});\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 830,
        "y": 680,
        "wires": [
            [
                "1143d163.fef4df"
            ]
        ]
    },
    {
        "id": "1143d163.fef4df",
        "type": "fs-file-lister",
        "z": "ce09026f.e98f",
        "name": "",
        "start": "/",
        "pattern": "*.*",
        "folders": "*",
        "hidden": true,
        "lstype": "files",
        "path": true,
        "single": true,
        "depth": 0,
        "stat": true,
        "showWarnings": false,
        "x": 840,
        "y": 760,
        "wires": [
            [
                "28907a53.6b5d46"
            ]
        ]
    },
    {
        "id": "28907a53.6b5d46",
        "type": "switch",
        "z": "ce09026f.e98f",
        "name": "",
        "property": "payload",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1010,
        "y": 760,
        "wires": [
            [
                "78f20914.71d2e8"
            ],
            [
                "f3847eaa.61b65"
            ]
        ]
    },
    {
        "id": "78f20914.71d2e8",
        "type": "change",
        "z": "ce09026f.e98f",
        "name": "Get file content",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "filecontent",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1220,
        "y": 740,
        "wires": [
            [
                "c4d4a34b.ef4aa"
            ]
        ]
    },
    {
        "id": "f3847eaa.61b65",
        "type": "change",
        "z": "ce09026f.e98f",
        "name": "Get file content",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "filecontent",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1220,
        "y": 780,
        "wires": [
            [
                "a3698f8a.5cd96"
            ]
        ]
    },
    {
        "id": "c4d4a34b.ef4aa",
        "type": "csv",
        "z": "ce09026f.e98f",
        "name": "",
        "sep": "\\t",
        "hdrin": "",
        "hdrout": "all",
        "multi": "one",
        "ret": "\\n",
        "temp": "timestamp,temperatura_1,temperatura_2,asse_x,asse_y,asse_z,coppia",
        "skip": "0",
        "strings": true,
        "include_empty_strings": "",
        "include_null_values": "",
        "x": 1390,
        "y": 740,
        "wires": [
            [
                "f4be3358.e1cea"
            ]
        ]
    },
    {
        "id": "a3698f8a.5cd96",
        "type": "csv",
        "z": "ce09026f.e98f",
        "name": "",
        "sep": "\\t",
        "hdrin": "",
        "hdrout": "none",
        "multi": "one",
        "ret": "\\n",
        "temp": "timestamp,temperatura1,temperatura2,assex,assey,assez,coppia",
        "skip": "0",
        "strings": true,
        "include_empty_strings": "",
        "include_null_values": "",
        "x": 1390,
        "y": 780,
        "wires": [
            [
                "f4be3358.e1cea"
            ]
        ]
    },
    {
        "id": "f4be3358.e1cea",
        "type": "file",
        "z": "ce09026f.e98f",
        "name": "",
        "filename": "",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 1570,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "10595e71.7a83c2",
        "type": "change",
        "z": "ce09026f.e98f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "data",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 460,
        "wires": [
            [
                "31df3309.cc00cc"
            ]
        ]
    },
    {
        "id": "31df3309.cc00cc",
        "type": "function",
        "z": "ce09026f.e98f",
        "name": "Replace decimal separator",
        "func": "var i;\nfor(i=1; i < msg.payload.length; i++) {\nmsg.payload[i] = msg.payload[i].toString().replace(\".\",\",\");\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 860,
        "y": 580,
        "wires": [
            [
                "225b4943.0d7cd6"
            ]
        ]
    },
    {
        "id": "5c6e04ee.4f739c",
        "type": "ui_date_picker",
        "z": "ce09026f.e98f",
        "name": "",
        "label": "date",
        "group": "a54f994b.fa7e08",
        "order": 2,
        "width": "4",
        "height": "1",
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "x": 360,
        "y": 840,
        "wires": [
            [
                "f603b10d.27b7b"
            ]
        ]
    },
    {
        "id": "4760da7c.f23914",
        "type": "inject",
        "z": "ce09026f.e98f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 840,
        "wires": [
            [
                "5c6e04ee.4f739c"
            ]
        ]
    },
    {
        "id": "cb23da81.886f48",
        "type": "split",
        "z": "ce09026f.e98f",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 130,
        "y": 340,
        "wires": [
            [
                "ba7cd94c.efc0f8"
            ]
        ]
    },
    {
        "id": "c9339f80.5587e",
        "type": "delay",
        "z": "ce09026f.e98f",
        "name": "",
        "pauseType": "queue",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "10",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "outputs": 1,
        "x": 970,
        "y": 120,
        "wires": [
            [
                "ecc46bca.601bb8"
            ]
        ]
    },
    {
        "id": "88ba9951.2045a8",
        "type": "batch",
        "z": "ce09026f.e98f",
        "name": "",
        "mode": "interval",
        "count": 10,
        "overlap": 0,
        "interval": "1",
        "allowEmptySequence": false,
        "topics": [],
        "x": 970,
        "y": 200,
        "wires": [
            [
                "f5eea78f.5a29c8"
            ]
        ]
    },
    {
        "id": "8ccddb9a.a55f38",
        "type": "inject",
        "z": "b511e93e.cbd928",
        "name": "temperature",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "temperature",
        "payload": "10",
        "payloadType": "num",
        "x": 190,
        "y": 120,
        "wires": [
            [
                "47b769c5.cb0e28"
            ]
        ]
    },
    {
        "id": "47b769c5.cb0e28",
        "type": "join",
        "z": "b511e93e.cbd928",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "3",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 390,
        "y": 160,
        "wires": [
            [
                "f9afb265.b11b7"
            ]
        ]
    },
    {
        "id": "f9afb265.b11b7",
        "type": "debug",
        "z": "b511e93e.cbd928",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 550,
        "y": 160,
        "wires": []
    },
    {
        "id": "2d269127.4f04ce",
        "type": "inject",
        "z": "b511e93e.cbd928",
        "name": "humidity",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "humidity",
        "payload": "",
        "payloadType": "num",
        "x": 180,
        "y": 160,
        "wires": [
            [
                "47b769c5.cb0e28"
            ]
        ]
    },
    {
        "id": "d6fbe805.0e4628",
        "type": "inject",
        "z": "b511e93e.cbd928",
        "name": "pressure",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "pressure",
        "payload": "999",
        "payloadType": "num",
        "x": 180,
        "y": 200,
        "wires": [
            [
                "47b769c5.cb0e28"
            ]
        ]
    },
    {
        "id": "1b84b260.7d3d6e",
        "type": "inject",
        "z": "2ca7873.8485f78",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "@;0000228500;00873;00889;02039;02023;02450;00004@;0000228550;00872;00887;02039;02024;02452;00002@;0000228600;00874;00890;02040;02024;02451;00004@;0000228650;00874;00889;02038;02024;02450;00004@;0000228700;00873;00889;02039;02024;02452;00002@;0000228750;00874;00889;02039;02023;02450;00004@;0000228800;00873;00889;02039;02022;02451;00004@;0000228850;00873;00888;02039;02024;02452;00001@;0000228900;00874;00890;02038;02024;02450;00004@;0000228950;00873;00889;02039;02024;02452;00002",
        "payloadType": "str",
        "x": 120,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "e3f77ac2.1cdd68",
        "type": "debug",
        "z": "2ca7873.8485f78",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 340,
        "wires": []
    },
    {
        "id": "947acdb7.1eb67",
        "type": "mqtt in",
        "z": "2ca7873.8485f78",
        "name": "",
        "topic": "ESP32DevKit123/outTopic10",
        "qos": "2",
        "datatype": "auto",
        "broker": "d220cbeb.3f2478",
        "inputs": 0,
        "x": 160,
        "y": 260,
        "wires": [
            [
                "b9477775.2d0928"
            ]
        ]
    },
    {
        "id": "b9477775.2d0928",
        "type": "split",
        "z": "2ca7873.8485f78",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 370,
        "y": 260,
        "wires": [
            [
                "176f1648.ccf84a"
            ]
        ]
    },
    {
        "id": "176f1648.ccf84a",
        "type": "function",
        "z": "2ca7873.8485f78",
        "name": "split pacchetto",
        "func": "var s = msg.payload;\n\n// stringa di prova\n//var s=\"@;0001051048;00869;00426;02420;00472;00000;01234\";\n// array con le parti di s\nvar o = s.split(\";\");\n// array di uscita\nvar a=[];\n\n// nomi dei topics\n//          o = [@, 0001208869, 00000, 00000, 00573,... ];\nvar topicName = [\"header\",\"timestamp\",\"A1\",\"A2\",\"A3\",\"A4\",\"A5\",\"A6\"];\n\n// ciclo di creazione delle uscite\nvar i;\nfor(i=1; i < topicName.length; i++) {\n    t = topicName[i];\n    //v = values[i];\n    v=parseInt(o[i]);\n    a.push({\"topic\":t,\"payload\":v});\n    //node.warn({\"topic\":t,\"payload\":v});\n}\n//node.warn(a);\nreturn a;",
        "outputs": 7,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 620,
        "y": 380,
        "wires": [
            [
                "e3f77ac2.1cdd68"
            ],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "id": "a5d91ef2.587fc",
        "type": "mqtt in",
        "z": "c47a0e17.12827",
        "name": "",
        "topic": "B/keep",
        "qos": "0",
        "datatype": "auto",
        "broker": "5281f4aa.e927ac",
        "inputs": 0,
        "x": 170,
        "y": 160,
        "wires": [
            [
                "79229350.c6a29c"
            ]
        ]
    },
    {
        "id": "79229350.c6a29c",
        "type": "json",
        "z": "c47a0e17.12827",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 310,
        "y": 160,
        "wires": [
            [
                "6c0a8d2e.7cca84",
                "4d89dbb6.a61854",
                "880c3936.a311a8"
            ]
        ]
    },
    {
        "id": "9384464a.ee9f78",
        "type": "mqtt in",
        "z": "c47a0e17.12827",
        "name": "",
        "topic": "Huzzah32/BME280",
        "qos": "2",
        "datatype": "auto",
        "broker": "26077238.d6034e",
        "inputs": 0,
        "x": 130,
        "y": 260,
        "wires": [
            [
                "75bda08.4206d6"
            ]
        ]
    },
    {
        "id": "75bda08.4206d6",
        "type": "json",
        "z": "c47a0e17.12827",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 310,
        "y": 260,
        "wires": [
            [
                "698f8506.ca00ec",
                "5c5dc58f.aac23c",
                "b21d525d.cc5f5"
            ]
        ]
    },
    {
        "id": "6c0a8d2e.7cca84",
        "type": "function",
        "z": "c47a0e17.12827",
        "name": "presRef",
        "func": "var newMsg = {};\nnewMsg.topic = \"presRef\";\nnewMsg.payload = msg.payload.pres;\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 520,
        "y": 160,
        "wires": [
            [
                "a5f0dc1e.c1d42"
            ]
        ]
    },
    {
        "id": "698f8506.ca00ec",
        "type": "function",
        "z": "c47a0e17.12827",
        "name": "presBME",
        "func": "var newMsg = {};\nnewMsg.topic = \"presBME\";\nnewMsg.payload = msg.payload.pres;\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 520,
        "y": 260,
        "wires": [
            [
                "a5f0dc1e.c1d42"
            ]
        ]
    },
    {
        "id": "20eb29c3.229646",
        "type": "debug",
        "z": "c47a0e17.12827",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1370,
        "y": 220,
        "wires": []
    },
    {
        "id": "4d89dbb6.a61854",
        "type": "function",
        "z": "c47a0e17.12827",
        "name": "tempRef",
        "func": "var newMsg = {};\nnewMsg.topic = \"tempRef\";\nnewMsg.payload = msg.payload.temp;\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 520,
        "y": 340,
        "wires": [
            [
                "a5f0dc1e.c1d42"
            ]
        ]
    },
    {
        "id": "5c5dc58f.aac23c",
        "type": "function",
        "z": "c47a0e17.12827",
        "name": "tempBME",
        "func": "var newMsg = {};\nnewMsg.topic = \"tempBME\";\nnewMsg.payload = msg.payload.temp;\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 520,
        "y": 400,
        "wires": [
            [
                "a5f0dc1e.c1d42"
            ]
        ]
    },
    {
        "id": "880c3936.a311a8",
        "type": "function",
        "z": "c47a0e17.12827",
        "name": "humiRef",
        "func": "var newMsg = {};\nnewMsg.topic = \"humiRef\";\nnewMsg.payload = msg.payload.humi;\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 520,
        "y": 480,
        "wires": [
            [
                "a5f0dc1e.c1d42"
            ]
        ]
    },
    {
        "id": "b21d525d.cc5f5",
        "type": "function",
        "z": "c47a0e17.12827",
        "name": "humiBME",
        "func": "var newMsg = {};\nnewMsg.topic = \"humiBME\";\nnewMsg.payload = msg.payload.humi;\nreturn newMsg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 520,
        "y": 520,
        "wires": [
            [
                "a5f0dc1e.c1d42"
            ]
        ]
    },
    {
        "id": "6a13d471.85e88c",
        "type": "file",
        "z": "c47a0e17.12827",
        "name": "",
        "filename": "/home/dietpi/nodered_data/prova.txt",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 780,
        "y": 740,
        "wires": [
            [
                "d8611910.2e3538"
            ]
        ]
    },
    {
        "id": "42dee562.931c0c",
        "type": "inject",
        "z": "c47a0e17.12827",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "timestamp",
        "payload": "",
        "payloadType": "date",
        "x": 490,
        "y": 740,
        "wires": [
            [
                "6a13d471.85e88c"
            ]
        ]
    },
    {
        "id": "d8611910.2e3538",
        "type": "debug",
        "z": "c47a0e17.12827",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1050,
        "y": 740,
        "wires": []
    },
    {
        "id": "44b1a158.fdaa6",
        "type": "csv",
        "z": "c47a0e17.12827",
        "name": "",
        "sep": ";",
        "hdrin": "",
        "hdrout": "none",
        "multi": "one",
        "ret": "\\r\\n",
        "temp": "presBME,presRef,tempBME,tempRef,humiBME,humiRef",
        "skip": "0",
        "strings": true,
        "include_empty_strings": "",
        "include_null_values": "",
        "x": 870,
        "y": 220,
        "wires": [
            [
                "420fa175.6e4eb",
                "e3967115.cf96a"
            ]
        ]
    },
    {
        "id": "e3967115.cf96a",
        "type": "file",
        "z": "c47a0e17.12827",
        "name": "",
        "filename": "/home/dietpi/nodered_data/BMEref.csv",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 1110,
        "y": 220,
        "wires": [
            [
                "20eb29c3.229646"
            ]
        ]
    },
    {
        "id": "420fa175.6e4eb",
        "type": "debug",
        "z": "c47a0e17.12827",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 750,
        "y": 60,
        "wires": []
    },
    {
        "id": "a5f0dc1e.c1d42",
        "type": "collector",
        "z": "c47a0e17.12827",
        "name": "collect_Pres",
        "onlyIfChanged": true,
        "x": 710,
        "y": 220,
        "wires": [
            [
                "44b1a158.fdaa6"
            ]
        ]
    },
    {
        "id": "4fc70246.3ab17c",
        "type": "join",
        "z": "3fa4d8c1.789b58",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "6",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "num",
        "reduceFixup": "",
        "x": 420,
        "y": 160,
        "wires": [
            [
                "decaeef2.fafc9",
                "baf76cdb.3d235",
                "73c63857.e054a8",
                "c8da5e97.6fa55"
            ]
        ]
    },
    {
        "id": "cc6f7778.4cbc38",
        "type": "inject",
        "z": "3fa4d8c1.789b58",
        "name": "tempRef",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "tempRef",
        "payload": "21.10",
        "payloadType": "num",
        "x": 130,
        "y": 100,
        "wires": [
            [
                "4fc70246.3ab17c"
            ]
        ]
    },
    {
        "id": "44e0510.c8159b",
        "type": "inject",
        "z": "3fa4d8c1.789b58",
        "name": "presRef",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "presRef",
        "payload": "1013.55",
        "payloadType": "num",
        "x": 120,
        "y": 180,
        "wires": [
            [
                "4fc70246.3ab17c"
            ]
        ]
    },
    {
        "id": "5015fa66.fa3564",
        "type": "inject",
        "z": "3fa4d8c1.789b58",
        "name": "humiRef",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "humiRef",
        "payload": "45.61",
        "payloadType": "num",
        "x": 130,
        "y": 260,
        "wires": [
            [
                "4fc70246.3ab17c"
            ]
        ]
    },
    {
        "id": "decaeef2.fafc9",
        "type": "debug",
        "z": "3fa4d8c1.789b58",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 590,
        "y": 160,
        "wires": []
    },
    {
        "id": "baf811c3.cb2a8",
        "type": "inject",
        "z": "3fa4d8c1.789b58",
        "name": "tempBME",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "tempBME",
        "payload": "22.15",
        "payloadType": "num",
        "x": 140,
        "y": 360,
        "wires": [
            [
                "4fc70246.3ab17c"
            ]
        ]
    },
    {
        "id": "f80164e8.83ca48",
        "type": "inject",
        "z": "3fa4d8c1.789b58",
        "name": "presBME",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "presBME",
        "payload": "1014.27",
        "payloadType": "num",
        "x": 140,
        "y": 420,
        "wires": [
            [
                "4fc70246.3ab17c"
            ]
        ]
    },
    {
        "id": "9cb9bfb2.043a",
        "type": "inject",
        "z": "3fa4d8c1.789b58",
        "name": "humiBME",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "humiBME",
        "payload": "80.80",
        "payloadType": "num",
        "x": 140,
        "y": 480,
        "wires": [
            [
                "4fc70246.3ab17c"
            ]
        ]
    },
    {
        "id": "baf76cdb.3d235",
        "type": "switch",
        "z": "3fa4d8c1.789b58",
        "name": "",
        "property": "payload.parts",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "tempRef",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "tempBME",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "presRef",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pressBME",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "humiRef",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "humiBME",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 6,
        "x": 590,
        "y": 320,
        "wires": [
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "id": "c8da5e97.6fa55",
        "type": "debug",
        "z": "3fa4d8c1.789b58",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "parts.count",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 760,
        "y": 240,
        "wires": []
    },
    {
        "id": "ab09f210.a7783",
        "type": "debug",
        "z": "3fa4d8c1.789b58",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 790,
        "y": 480,
        "wires": []
    },
    {
        "id": "73c63857.e054a8",
        "type": "sort",
        "z": "3fa4d8c1.789b58",
        "name": "",
        "order": "ascending",
        "as_num": false,
        "target": "payload",
        "targetType": "msg",
        "msgKey": "",
        "msgKeyType": "elem",
        "seqKey": "payload",
        "seqKeyType": "msg",
        "x": 600,
        "y": 480,
        "wires": [
            [
                "ab09f210.a7783"
            ]
        ]
    },
    {
        "id": "221816e5.71131a",
        "type": "mqtt in",
        "z": "c955b410.2b2588",
        "name": "",
        "topic": "ESP32DevKit123/outTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "26077238.d6034e",
        "inputs": 0,
        "x": 250,
        "y": 260,
        "wires": [
            [
                "2103d14d.cedc7e"
            ]
        ]
    },
    {
        "id": "dcdce1b7.6f0b7",
        "type": "debug",
        "z": "c955b410.2b2588",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1190,
        "y": 520,
        "wires": []
    },
    {
        "id": "e9024d41.674be",
        "type": "mqtt out",
        "z": "c955b410.2b2588",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "26077238.d6034e",
        "x": 470,
        "y": 1060,
        "wires": []
    },
    {
        "id": "37972533.4baeda",
        "type": "inject",
        "z": "c955b410.2b2588",
        "name": "PGA",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "ESP32DevKit123/PGA",
        "payload": "1",
        "payloadType": "num",
        "x": 150,
        "y": 1060,
        "wires": [
            [
                "e9024d41.674be"
            ]
        ]
    },
    {
        "id": "3a1d0f29.b77f1",
        "type": "function",
        "z": "c955b410.2b2588",
        "name": "create array",
        "func": "// this is where you define the legend for \n// the datasets\nvar title = \"Spettro FFT\";\nvar legend1 = \"Spettro delle ampiezze\";\n\n// variables to be used\nvar i, x, y, r;\nvar data1;\n//var xValues=[];\n//var yValues=[];\n\n////data1 = '{x: 4096.0,  y: 3.3,  r: 1},'; // Force the size of the chart\ndata1 ='';\n\nfor(i=0; i < msg.payload.length; i++) {\n    var s = msg.payload[i];\n    s.replace(\"\\n\", \"\");\n    var o = s.split(\"\\t\"); \n    x = (parseFloat(o[0])).toFixed(3);\n    y = (parseFloat(o[1])*3.3/4096.0).toFixed(2);\n    r = 1;\n//    //data1 += \"{x: \"+x+\", y: \"+y+\", r: \"+r+\"},\";\n    data1 += \"{x: \"+x+\", y: \"+y+\"},\";\n    \n//    xValues.push(x);\n//    yValues.push(y);\n}\n\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1\n};\n\n//msg.payload = { \"title\"   : title,\n//                \"legend1\" : legend1,\n//                \"xValues\" : xValues,\n//                \"yValues\" : yValues\n//};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 830,
        "y": 420,
        "wires": [
            [
                "e73495e4.aef428"
            ]
        ]
    },
    {
        "id": "bdd8042a.af0478",
        "type": "debug",
        "z": "c955b410.2b2588",
        "name": "flush null",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 680,
        "y": 280,
        "wires": []
    },
    {
        "id": "bff6daf8.009f38",
        "type": "debug",
        "z": "c955b410.2b2588",
        "name": "new entry",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 680,
        "y": 180,
        "wires": []
    },
    {
        "id": "2103d14d.cedc7e",
        "type": "subflow:6c259dd5.72f0d4",
        "z": "c955b410.2b2588",
        "name": "",
        "env": [
            {
                "name": "Buffer_Size",
                "value": "256",
                "type": "num"
            }
        ],
        "x": 490,
        "y": 260,
        "wires": [
            [
                "bff6daf8.009f38"
            ],
            [
                "31be542c.f0a19c"
            ]
        ]
    },
    {
        "id": "d34d468b.f11e88",
        "type": "comment",
        "z": "c955b410.2b2588",
        "name": "Ring Buffer",
        "info": "Link: [RING BUFFER](https://gist.github.com/machadotiago/a55bdbd0f573469cc987e1224f25c2aa)",
        "x": 480,
        "y": 180,
        "wires": []
    },
    {
        "id": "31be542c.f0a19c",
        "type": "switch",
        "z": "c955b410.2b2588",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "null",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 600,
        "y": 380,
        "wires": [
            [
                "bdd8042a.af0478",
                "3a1d0f29.b77f1"
            ]
        ]
    },
    {
        "id": "e73495e4.aef428",
        "type": "template",
        "z": "c955b410.2b2588",
        "name": "Create the msg.template to use",
        "field": "template",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<canvas id=\"fft-chart\" width=\"800\" height=\"460\" style=\"border:1px solid #000000;margin: 0px;\"></canvas>\n\n<script>\nnew Chart(document.getElementById(\"fft-chart\"), {\n    type: 'scatter',\n    data: {\n      datasets: [\n        {\n          label: \"{{{payload.legend1}}}\",\n          fill: false,\n          pointStyle: 'rectRot',\n          pointRadius: 2,\n          lineTension: 0,\n          pointBackgroundColor: \"rgb(0,0,255)\",\n          borderColor: 'rgb(54, 162, 235)',\n          data: [\n            {{{payload.data1}}}\n\n          ]\n        }\n      ]\n    },\n    options: {\n        animation: false,\n        fill: false,\n        legend: {\n            display: true,\n            labels: {\n                fontColor: 'rgb(0,0,0)'\n            }\n        },\n        layout: {\n                padding: 20\n            },    \n        title: {\n            display: true,\n            text: '{{{payload.title}}}'\n          }, \n        scales: {\n            xAxes: [{ \n              scaleLabel: {\n                display: true,\n                labelString: \"Frequenza [Hz]\"\n              },\n              ticks: {min: 0, max:4000, tickStep: 500}\n            }],            \n            yAxes: [{ \n              scaleLabel: {\n                display: true,\n                labelString: \"Ampiezza [V]\"\n              },\n              ticks: {min: 0, max:3.3}\n            }]\n          }\n    }\n});\n\n</script>\n",
        "output": "str",
        "x": 870,
        "y": 540,
        "wires": [
            [
                "2a2f99fe.f87fc6",
                "dcdce1b7.6f0b7"
            ]
        ]
    },
    {
        "id": "2a2f99fe.f87fc6",
        "type": "ui_template",
        "z": "c955b410.2b2588",
        "group": "2bf41b72.1ddbf4",
        "name": "Bubble (dynamic growing)",
        "order": 2,
        "width": "19",
        "height": "12",
        "format": "this will be ignored",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 850,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "9f8bb8bf.04aa48",
        "type": "inject",
        "z": "c955b410.2b2588",
        "name": "Description",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "This demo creates a bubble chart showing how you could dynamically add points to the plot. It initially creates two points (100, 100 and -100, -100) to create a fixed size area for the plot.  <br><br> It then reiterates 15 times adding a point to each dataset and displaying the plot again. It also removes the animation so the points just appear on the plot.",
        "payloadType": "str",
        "x": 440,
        "y": 680,
        "wires": [
            [
                "bc76dc43.df96"
            ]
        ]
    },
    {
        "id": "bc76dc43.df96",
        "type": "ui_text",
        "z": "c955b410.2b2588",
        "group": "2bf41b72.1ddbf4",
        "order": 1,
        "width": "8",
        "height": "1",
        "name": "demo 3 description",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 800,
        "y": 680,
        "wires": []
    },
    {
        "id": "dac210d.3a106f",
        "type": "mqtt out",
        "z": "c955b410.2b2588",
        "name": "",
        "topic": "ESP32DevKit123/PGA",
        "qos": "0",
        "retain": "",
        "broker": "26077238.d6034e",
        "x": 820,
        "y": 760,
        "wires": []
    },
    {
        "id": "376be65a.5990da",
        "type": "ui_dropdown",
        "z": "c955b410.2b2588",
        "name": "",
        "label": "Guadagno PGA",
        "tooltip": "",
        "place": "Seleziona un valore",
        "group": "2bf41b72.1ddbf4",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "x1",
                "value": 1,
                "type": "num"
            },
            {
                "label": "x2",
                "value": 2,
                "type": "num"
            },
            {
                "label": "x4",
                "value": 4,
                "type": "num"
            },
            {
                "label": "x5",
                "value": 5,
                "type": "num"
            },
            {
                "label": "x8",
                "value": 8,
                "type": "num"
            },
            {
                "label": "x10",
                "value": 10,
                "type": "num"
            },
            {
                "label": "x16",
                "value": 16,
                "type": "num"
            },
            {
                "label": "x32",
                "value": "32",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "x": 480,
        "y": 760,
        "wires": [
            [
                "dac210d.3a106f"
            ]
        ]
    },
    {
        "id": "a89e4d8b.8d43b",
        "type": "inject",
        "z": "c955b410.2b2588",
        "name": "preset PGA",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "PGAx1",
        "payloadType": "str",
        "x": 220,
        "y": 760,
        "wires": [
            [
                "376be65a.5990da"
            ]
        ]
    },
    {
        "id": "6094a325.d49c1c",
        "type": "mqtt in",
        "z": "2566fba7.49e2e4",
        "name": "",
        "topic": "ESP32DevKit123/outTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "26077238.d6034e",
        "inputs": 0,
        "x": 250,
        "y": 280,
        "wires": [
            [
                "16c4757a.386f2b"
            ]
        ]
    },
    {
        "id": "18563360.3c8e5d",
        "type": "debug",
        "z": "2566fba7.49e2e4",
        "name": "flush null",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 760,
        "y": 400,
        "wires": []
    },
    {
        "id": "f110c713.b3c548",
        "type": "debug",
        "z": "2566fba7.49e2e4",
        "name": "new entry",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 740,
        "y": 220,
        "wires": []
    },
    {
        "id": "2ddf358a.058b7a",
        "type": "subflow:6c259dd5.72f0d4",
        "z": "2566fba7.49e2e4",
        "name": "",
        "env": [
            {
                "name": "Buffer_Size",
                "value": "4096",
                "type": "num"
            },
            {
                "name": "Buffer_Reset",
                "value": "true",
                "type": "bool"
            }
        ],
        "x": 550,
        "y": 280,
        "wires": [
            [
                "f110c713.b3c548"
            ],
            [
                "3b6a7b.9c763586"
            ]
        ]
    },
    {
        "id": "10aa1999.ba60b6",
        "type": "comment",
        "z": "2566fba7.49e2e4",
        "name": "Ring Buffer",
        "info": "Link: [RING BUFFER](https://gist.github.com/machadotiago/a55bdbd0f573469cc987e1224f25c2aa)",
        "x": 520,
        "y": 240,
        "wires": []
    },
    {
        "id": "3b6a7b.9c763586",
        "type": "switch",
        "z": "2566fba7.49e2e4",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "null",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 600,
        "y": 400,
        "wires": [
            [
                "18563360.3c8e5d",
                "b3d0e4f9.198198"
            ]
        ]
    },
    {
        "id": "bc8da6db.1f0a38",
        "type": "split",
        "z": "2566fba7.49e2e4",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 380,
        "y": 400,
        "wires": [
            [
                "2ddf358a.058b7a"
            ]
        ]
    },
    {
        "id": "16c4757a.386f2b",
        "type": "function",
        "z": "2566fba7.49e2e4",
        "name": "strip last '\\n'",
        "func": "oldStr = msg.payload\nvar newStr = oldStr.slice(0, oldStr.length-1);\nmsg.payload = newStr\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 210,
        "y": 400,
        "wires": [
            [
                "bc8da6db.1f0a38"
            ]
        ]
    },
    {
        "id": "4445c262.0a486c",
        "type": "debug",
        "z": "2566fba7.49e2e4",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 870,
        "y": 600,
        "wires": []
    },
    {
        "id": "b3d0e4f9.198198",
        "type": "function",
        "z": "2566fba7.49e2e4",
        "name": "create array",
        "func": "// this is where you define the legend for \n// the datasets\nvar title = \"Spettro FFT\";\nvar legend1 = \"Spettro delle ampiezze\";\n\n// variables to be used\nvar i, x, y, r;\nvar data1;\n//var xValues=[];\n//var yValues=[];\n\ndata1 ='';\n\nfor(i=0; i < msg.payload.length; i++) {\n    var s = msg.payload[i];\n    s.replace(\"\\n\", \"\");\n    var o = s.split(\"\\t\"); \n    x = (parseFloat(o[0])).toFixed(3);\n    y = (parseFloat(o[1])*3.3/4096.0).toFixed(2);\n    r = 1;\n//    //data1 += \"{x: \"+x+\", y: \"+y+\", r: \"+r+\"},\";\n    data1 += \"{x: \"+x+\", y: \"+y+\"},\";\n    \n//    xValues.push(x);\n//    yValues.push(y);\n}\n\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1\n};\n\n//msg.payload = { \"title\"   : title,\n//                \"legend1\" : legend1,\n//                \"xValues\" : xValues,\n//                \"yValues\" : yValues\n//};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 510,
        "y": 500,
        "wires": [
            [
                "d242f04b.dd177"
            ]
        ]
    },
    {
        "id": "d242f04b.dd177",
        "type": "template",
        "z": "2566fba7.49e2e4",
        "name": "Create the msg.template to use",
        "field": "template",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<canvas id=\"fft-chart\" width=\"800\" height=\"460\" style=\"border:1px solid #000000;margin: 0px;\"></canvas>\n\n<script>\nnew Chart(document.getElementById(\"fft-chart\"), {\n    type: 'scatter',\n    data: {\n      datasets: [\n        {\n          label: \"{{{payload.legend1}}}\",\n          fill: false,\n          pointStyle: 'rectRot',\n          pointRadius: 2,\n          lineTension: 0,\n          pointBackgroundColor: \"rgb(0,0,255)\",\n          borderColor: 'rgb(54, 162, 235)',\n          data: [\n            {{{payload.data1}}}\n\n          ]\n        }\n      ]\n    },\n    options: {\n        animation: false,\n        fill: false,\n        legend: {\n            display: true,\n            labels: {\n                fontColor: 'rgb(0,0,0)'\n            }\n        },\n        layout: {\n                padding: 20\n            },    \n        title: {\n            display: true,\n            text: '{{{payload.title}}}'\n          }, \n        scales: {\n            xAxes: [{ \n              scaleLabel: {\n                display: true,\n                labelString: \"Frequenza [Hz]\"\n              },\n              ticks: {min: 0, max:4000, tickStep: 500}\n            }],            \n            yAxes: [{ \n              scaleLabel: {\n                display: true,\n                labelString: \"Ampiezza [V]\"\n              },\n              ticks: {min: 0, max:3.3}\n            }]\n          }\n    }\n});\n\n</script>\n",
        "output": "str",
        "x": 550,
        "y": 620,
        "wires": [
            [
                "4445c262.0a486c",
                "21b9e029.e8a97"
            ]
        ]
    },
    {
        "id": "21b9e029.e8a97",
        "type": "ui_template",
        "z": "2566fba7.49e2e4",
        "group": "2bf41b72.1ddbf4",
        "name": "Bubble (dynamic growing)",
        "order": 2,
        "width": "19",
        "height": "12",
        "format": "this will be ignored",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 830,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "842fdb22.e28738",
        "type": "inject",
        "z": "2566fba7.49e2e4",
        "name": "Description",
        "props": [
            {
                "p": "payload",
                "v": "This demo creates a bubble chart showing how you could dynamically add points to the plot. It initially creates two points (100, 100 and -100, -100) to create a fixed size area for the plot.  <br><br> It then reiterates 15 times adding a point to each dataset and displaying the plot again. It also removes the animation so the points just appear on the plot.",
                "vt": "str"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "string"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "This demo creates a bubble chart showing how you could dynamically add points to the plot. It initially creates two points (100, 100 and -100, -100) to create a fixed size area for the plot.  <br><br> It then reiterates 15 times adding a point to each dataset and displaying the plot again. It also removes the animation so the points just appear on the plot.",
        "payloadType": "str",
        "x": 420,
        "y": 780,
        "wires": [
            [
                "de3b00f7.7c972"
            ]
        ]
    },
    {
        "id": "de3b00f7.7c972",
        "type": "ui_text",
        "z": "2566fba7.49e2e4",
        "group": "2bf41b72.1ddbf4",
        "order": 1,
        "width": "8",
        "height": "1",
        "name": "demo 3 description",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 780,
        "y": 780,
        "wires": []
    },
    {
        "id": "75399e5e.e597c",
        "type": "mqtt out",
        "z": "2566fba7.49e2e4",
        "name": "",
        "topic": "ESP32DevKit123/PGA",
        "qos": "0",
        "retain": "",
        "broker": "26077238.d6034e",
        "x": 800,
        "y": 860,
        "wires": []
    },
    {
        "id": "a1407414.e43dc8",
        "type": "ui_dropdown",
        "z": "2566fba7.49e2e4",
        "name": "",
        "label": "Guadagno PGA",
        "tooltip": "",
        "place": "Seleziona un valore",
        "group": "2bf41b72.1ddbf4",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "x1",
                "value": 1,
                "type": "num"
            },
            {
                "label": "x2",
                "value": 2,
                "type": "num"
            },
            {
                "label": "x4",
                "value": 4,
                "type": "num"
            },
            {
                "label": "x5",
                "value": 5,
                "type": "num"
            },
            {
                "label": "x8",
                "value": 8,
                "type": "num"
            },
            {
                "label": "x10",
                "value": 10,
                "type": "num"
            },
            {
                "label": "x16",
                "value": 16,
                "type": "num"
            },
            {
                "label": "x32",
                "value": "32",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "x": 460,
        "y": 860,
        "wires": [
            [
                "75399e5e.e597c"
            ]
        ]
    },
    {
        "id": "b87b4ed8.4d21b",
        "type": "inject",
        "z": "2566fba7.49e2e4",
        "name": "preset PGA",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 200,
        "y": 860,
        "wires": [
            [
                "a1407414.e43dc8"
            ]
        ]
    },
    {
        "id": "8c1af36c.12252",
        "type": "ui_button",
        "z": "2566fba7.49e2e4",
        "name": "",
        "group": "2bf41b72.1ddbf4",
        "order": 4,
        "width": "4",
        "height": "1",
        "passthru": false,
        "label": "Single shot",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "1",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 230,
        "y": 960,
        "wires": [
            [
                "97017184.b7d14"
            ]
        ]
    },
    {
        "id": "97017184.b7d14",
        "type": "mqtt out",
        "z": "2566fba7.49e2e4",
        "name": "",
        "topic": "ESP32DevKit123/trigger",
        "qos": "0",
        "retain": "",
        "broker": "26077238.d6034e",
        "x": 820,
        "y": 960,
        "wires": []
    },
    {
        "id": "6c6da246.50b7ec",
        "type": "ui_button",
        "z": "2566fba7.49e2e4",
        "name": "",
        "group": "2bf41b72.1ddbf4",
        "order": 4,
        "width": "4",
        "height": "1",
        "passthru": false,
        "label": "Free Run",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "2",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 220,
        "y": 1020,
        "wires": [
            [
                "97017184.b7d14"
            ]
        ]
    },
    {
        "id": "6041b7e2.4be968",
        "type": "ui_button",
        "z": "2566fba7.49e2e4",
        "name": "",
        "group": "2bf41b72.1ddbf4",
        "order": 4,
        "width": "4",
        "height": "1",
        "passthru": false,
        "label": "Stop ",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "0",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 210,
        "y": 1080,
        "wires": [
            [
                "97017184.b7d14"
            ]
        ]
    },
    {
        "id": "f2fab4.b664555",
        "type": "ui_button",
        "z": "2566fba7.49e2e4",
        "name": "",
        "group": "2bf41b72.1ddbf4",
        "order": 9,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Reset",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "0",
        "payloadType": "num",
        "topic": "topic",
        "topicType": "msg",
        "x": 190,
        "y": 180,
        "wires": [
            [
                "a92ee017.5928e"
            ]
        ]
    },
    {
        "id": "a92ee017.5928e",
        "type": "function",
        "z": "2566fba7.49e2e4",
        "name": "",
        "func": "msg.topic = \"ResetQueue\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 320,
        "y": 180,
        "wires": [
            [
                "2ddf358a.058b7a"
            ]
        ]
    },
    {
        "id": "776da4f7.706a64",
        "type": "ui_template",
        "z": "35e1e32f.937e74",
        "group": "21fb4565.85565a",
        "name": "Bubble Chart (static)",
        "order": 2,
        "width": "8",
        "height": "8",
        "format": "<canvas id=\"bubble-static\" width=\"1\" height=\"1\" style=\"border:1px solid #000000;\"></canvas>\n\n<script>\nnew Chart(document.getElementById(\"bubble-static\"), {\n    type: 'bubble',\n    data: {\n      labels: \"label\",\n      datasets: [\n        {\n          label: \"Bases\",\n          backgroundColor: \"rgba(255, 216, 0, 1.0)\",\n          borderColor: \"#000\",\n          data: [\n          \t{ x: -85, y: 79,    r: 2 },\n          \t{ x: 385, y: -279,  r: 2 },\n          \t{x: 207,  y: -461,  r: 2 },\n          \t{x: 262,  y: -548,  r: 2 },\n          \t{x: 388,  y: -1320, r: 2 },\n          \t{x: 415,  y: 185,   r: 2 },\n          \t{x: 584,  y: -1100, r: 2 }\n          ]\n        }, {\n          label: [\"POI\"], \n          backgroundColor: \"rgba(72, 255, 70,1.0)\",\n          borderColor: \"#000\",\n          data: [\n          \t{x: 106, y: -381,  r: 2 },\n          \t{x: 174, y: -119,  r: 2 },\n          \t{x: 185, y: -780,  r: 2 },\n          \t{x: 244, y: -1113, r: 2 },\n          \t{x: 261, y: -1319, r: 2 },\n          \t{x: 296, y: -100,  r: 2 }\n\t\t  ]\n        }\n      ]\n    },\n    options: {\n        legend: {\n            display: true,\n            labels: {\n                fontColor: 'rgb(255, 99, 132)'\n            }\n        },\n      title: {\n        display: true,\n        text: 'Demo1: static Bubble chart'\n      }, scales: {\n        yAxes: [{ \n          scaleLabel: {\n            display: true,\n            labelString: \"yAxes\"\n          }\n        }],\n        xAxes: [{ \n          scaleLabel: {\n            display: true,\n            labelString: \"xAxes\"\n          }\n        }]\n      }\n    }\n});\n\n</script>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "templateScope": "local",
        "x": 180,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "51dd8974.23fe18",
        "type": "ui_text",
        "z": "35e1e32f.937e74",
        "group": "21fb4565.85565a",
        "order": 1,
        "width": "8",
        "height": "3",
        "name": "demo 1 description",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 510,
        "y": 340,
        "wires": []
    },
    {
        "id": "cf71d781.a18048",
        "type": "inject",
        "z": "35e1e32f.937e74",
        "name": "Description",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "This demo creates a bubble chart showing how you could statically add the points in the ui_template node.<br><br> While this is not very useful, it is the basis of the dynamic charts in the other tabs. ",
        "payloadType": "str",
        "x": 150,
        "y": 340,
        "wires": [
            [
                "51dd8974.23fe18"
            ]
        ]
    },
    {
        "id": "ddeb2adc.cfc13",
        "type": "comment",
        "z": "35e1e32f.937e74",
        "name": "Static Bubble chart with 15 points per dataset",
        "info": "The attached flows demonstrates how to create a Bubble chart (using chart.js) with both static data, variable data and growing variable data. The key is using the 'template' node (not the 'ui_template' node) when building the dynamic plots.",
        "x": 230,
        "y": 40,
        "wires": []
    },
    {
        "id": "ddfaa9da.2513b8",
        "type": "debug",
        "z": "5c66fca0.b4e21c",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 470,
        "y": 220,
        "wires": []
    },
    {
        "id": "d19083e3.c4e8f8",
        "type": "debug",
        "z": "5c66fca0.b4e21c",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 470,
        "y": 280,
        "wires": []
    },
    {
        "id": "a8d7b7c8.c00498",
        "type": "function",
        "z": "5c66fca0.b4e21c",
        "name": "Build the datsets to be displayed",
        "func": "// this is where you define the legend for \n// the datasets\nvar title = \"Demo2: dynamic random Bubble chart\";\nvar legend1 = \"legend1\";\nvar legend2 = \"legend2\";\n\n// variables to be used to \nvar i, x, y, r, data1, data2;\nvar data1 = '';\nvar data2 = '';\n\n// for dataset #1\n// this code generates between 3 and 25 random\n// x/y points each between -100 and +100\n// and a random size between 1 and 2\nvar data_items = getRndInteger(3,15);\n\nfor (i = 0; i < data_items; i++) {\n    x = getRndInteger(-100,100);\n    y = getRndInteger(-100,100);\n    r = getRndInteger(0,2);\n    data1 += \"{x: \"+x+\", y: \"+y+\", r: \"+r+\"},\";\n}\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\nmsg.payload = {\"data1\": data1};\n\n// for dataset #2\n// this code generates between 3 and 25 random\n// x/y points each between -100 and +100\n// and a random size between 1 and 2\n\n    data_items = getRndInteger(3,15);\n\nfor (i = 0; i < data_items; i++) {\n    x = getRndInteger(-100,100);\n    y = getRndInteger(-100,100);\n    r = getRndInteger(1,2);\n    data2 += \"{x: \"+x+\", y: \"+y+\", r: \"+r+\"},\";\n}\n// this line removes the last comma to end the dataset\ndata2 = data2.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                \"legend2\" : legend2,\n                \"data2\"   : data2};\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "x": 220,
        "y": 160,
        "wires": [
            [
                "5662b8a0.f683a8",
                "ea57d27b.488398"
            ]
        ]
    },
    {
        "id": "5662b8a0.f683a8",
        "type": "debug",
        "z": "5c66fca0.b4e21c",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 470,
        "y": 160,
        "wires": []
    },
    {
        "id": "42741016.e5a2c8",
        "type": "inject",
        "z": "5c66fca0.b4e21c",
        "name": "",
        "repeat": "3",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Inject every 3 seconds",
        "payloadType": "str",
        "x": 190,
        "y": 100,
        "wires": [
            [
                "a8d7b7c8.c00498"
            ]
        ]
    },
    {
        "id": "ea57d27b.488398",
        "type": "template",
        "z": "5c66fca0.b4e21c",
        "name": "Create the msg.template to use",
        "field": "template",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<canvas id=\"bubble-chart\" width=\"1\" height=\"1\" style=\"border:1px solid #000000;\"></canvas>\n\n<script>\nnew Chart(document.getElementById(\"bubble-chart\"), {\n    type: 'bubble',\n    data: {\n      labels: \"label\",\n      datasets: [\n        {\n          label: \"{{{payload.legend1}}}\",\n          backgroundColor: \"rgba(65, 72, 255, 1.0000)\",\n          borderColor: \"#000\",\n          data: [\n            {{{payload.data1}}}\n\n          ]\n        }, {\n          label: [\"{{{payload.legend2}}}\"], \n          backgroundColor: \"rgba(255, 45, 36, 1.0000)\",\n          borderColor: \"#000\",\n          data: [\n              {{{payload.data2}}}\n\t\t  ]\n        }\n      ]\n    },\n    options: {\n        legend: {\n            display: true,\n            labels: {\n                fontColor: 'rgb(255, 99, 132)'\n            }\n        },\n    title: {\n        display: true,\n        text: '{{{payload.title}}}'\n      }, scales: {\n        yAxes: [{ \n          scaleLabel: {\n            display: true,\n            labelString: \"yAxes\"\n          }\n        }],\n        xAxes: [{ \n          scaleLabel: {\n            display: true,\n            labelString: \"xAxes\"\n          }\n        }]\n      }\n    }\n});\n\n</script>\n",
        "output": "str",
        "x": 210,
        "y": 220,
        "wires": [
            [
                "ddfaa9da.2513b8",
                "1d2b2d64.63418b"
            ]
        ]
    },
    {
        "id": "3d389e03.8d368a",
        "type": "comment",
        "z": "5c66fca0.b4e21c",
        "name": "Dynamic Bubble chart with 15 points per dataset",
        "info": "",
        "x": 240,
        "y": 40,
        "wires": []
    },
    {
        "id": "a4efa622.e373a",
        "type": "inject",
        "z": "5c66fca0.b4e21c",
        "name": "Description",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "This demo creates a bubble chart showing how you could, in a 'function' node,  dynamically add points to the datasets sent to the chart. <br><br>It creates 15 random data points for each dataset and then sends the entire set of points at one time, waits 3 seconds and repeats.",
        "payloadType": "str",
        "x": 150,
        "y": 340,
        "wires": [
            [
                "115e414a.fe70ef"
            ]
        ]
    },
    {
        "id": "1d2b2d64.63418b",
        "type": "ui_template",
        "z": "5c66fca0.b4e21c",
        "group": "a1a4b9da.737a38",
        "name": "Bubble (dynamic)",
        "order": 2,
        "width": "8",
        "height": "8",
        "format": "this will be ignored",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 170,
        "y": 280,
        "wires": [
            [
                "d19083e3.c4e8f8"
            ]
        ]
    },
    {
        "id": "115e414a.fe70ef",
        "type": "ui_text",
        "z": "5c66fca0.b4e21c",
        "group": "a1a4b9da.737a38",
        "order": 1,
        "width": "8",
        "height": "3",
        "name": "demo 2 description",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 510,
        "y": 340,
        "wires": []
    },
    {
        "id": "675201b7.44678",
        "type": "debug",
        "z": "ed34b63.0ee70c8",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 470,
        "y": 220,
        "wires": []
    },
    {
        "id": "4b31a900.53d8e8",
        "type": "debug",
        "z": "ed34b63.0ee70c8",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 470,
        "y": 280,
        "wires": []
    },
    {
        "id": "7118e1f3.a55ad",
        "type": "function",
        "z": "ed34b63.0ee70c8",
        "name": "Build two cumulating random datasets",
        "func": "// this is where you define the legend for \n// the datasets\nvar title = \"Demo3: random growing Bubble chart\";\nvar legend1 = \"legend1\";\nvar legend2 = \"legend2\";\n\n// variables to be used to \nvar i, x, y, r;\n// initialise the counter to 0 if it doesn't exist already\nvar data1 = flow.get('data1')||'';\nvar data2 = flow.get('data2')||'';\n\nvar count = flow.get('count')||0;\ncount += 1;\nif (count > 15) {\n    count = 1;\n    data1 = '{x: 100,  y: 100,  r: 1},'; // Force the size of the\n    data2 = '{x: -100, y: -100, r: 1},'; // plot so it won't resize\n} \n// store the value back\nflow.set('count',count);\n// make it part of the outgoing msg object\nmsg.count = count;\n\n// for dataset #1\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n//node.warn(\"db1=\"+data1);\nx = getRndInteger(-100,100);\ny = getRndInteger(-100,100);\nr = getRndInteger(0,10);\ndata1 += \"{x: \"+x+\", y: \"+y+\", r: \"+r+\"},\";\n//node.warn(\"db2=\"+data1);\n// this line removes the last comma to end the dataset\ndata1 = data1.replace(/^(.*),(.*?)$/, '$1')\n\n// for dataset #2\n// this code generates one x/y point \n// between -100 and +100 and a random \n//size between 1 and 10\n\nx = getRndInteger(-100,100);\ny = getRndInteger(-100,100);\nr = getRndInteger(1,10);\ndata2 += \"{x: \"+x+\", y: \"+y+\", r: \"+r+\"},\";\n\n// this line removes the last comma to end the dataset\ndata2 = data2.replace(/^(.*),(.*?)$/, '$1')\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                \"legend2\" : legend2,\n                \"data2\"   : data2};\ndata1 += \",\";\ndata2 += \",\";\n\nflow.set([\"data1\", \"data2\"], [data1, data2]);\nreturn msg;\n\n// this code gets a random interger\nfunction getRndInteger(min, max) {\n    return Math.floor(Math.random() * (max - min + 1) ) + min;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 230,
        "y": 160,
        "wires": [
            [
                "7ed7ca70.b0a8fc",
                "aeee9b3a.3c13a"
            ]
        ]
    },
    {
        "id": "7ed7ca70.b0a8fc",
        "type": "debug",
        "z": "ed34b63.0ee70c8",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 470,
        "y": 160,
        "wires": []
    },
    {
        "id": "52f5764.47eec88",
        "type": "inject",
        "z": "ed34b63.0ee70c8",
        "name": "Inject every second",
        "props": [
            {
                "p": "payload",
                "v": "",
                "vt": "str"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "string"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 180,
        "y": 100,
        "wires": [
            [
                "7118e1f3.a55ad"
            ]
        ]
    },
    {
        "id": "aeee9b3a.3c13a",
        "type": "template",
        "z": "ed34b63.0ee70c8",
        "name": "Create the msg.template to use",
        "field": "template",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<canvas id=\"bubble-chart\" width=\"1\" height=\"1\" style=\"border:1px solid #000000;\"></canvas>\n\n<script>\nnew Chart(document.getElementById(\"bubble-chart\"), {\n    type: 'bubble',\n    data: {\n      labels: \"label\",\n      datasets: [\n        {\n          label: \"{{{payload.legend1}}}\",\n          backgroundColor: \"rgba(65, 72, 255, 1.0000)\",\n          borderColor: \"#000\",\n          data: [\n            {{{payload.data1}}}\n\n          ]\n        }, {\n          label: [\"{{{payload.legend2}}}\"], \n          backgroundColor: \"rgba(255, 45, 36, 1.0000)\",\n          borderColor: \"#000\",\n          data: [\n              {{{payload.data2}}}\n\t\t  ]\n        }\n      ]\n    },\n    options: {\n        animation: false,\n        legend: {\n            display: true,\n            labels: {\n                fontColor: 'rgb(255, 99, 132)'\n            }\n        },\n    title: {\n        display: true,\n        text: '{{{payload.title}}}'\n      }, scales: {\n        yAxes: [{ \n          scaleLabel: {\n            display: true,\n            labelString: \"yAxes\"\n          }\n        }],\n        xAxes: [{ \n          scaleLabel: {\n            display: true,\n            labelString: \"xAxes\"\n          }\n        }]\n      }\n    }\n});\n\n</script>\n",
        "output": "str",
        "x": 210,
        "y": 220,
        "wires": [
            [
                "675201b7.44678",
                "90a482c4.75a6f"
            ]
        ]
    },
    {
        "id": "806c0bc9.f33db",
        "type": "comment",
        "z": "ed34b63.0ee70c8",
        "name": "Dynamic Bubble chart adding new points (up to 15)",
        "info": "This demo creates a ",
        "x": 250,
        "y": 40,
        "wires": []
    },
    {
        "id": "90a482c4.75a6f",
        "type": "ui_template",
        "z": "ed34b63.0ee70c8",
        "group": "ed68b86d.026b2",
        "name": "Bubble (dynamic growing)",
        "order": 2,
        "width": "8",
        "height": "8",
        "format": "this will be ignored",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "templateScope": "local",
        "x": 190,
        "y": 280,
        "wires": [
            [
                "4b31a900.53d8e8"
            ]
        ]
    },
    {
        "id": "d9b38376.3718b",
        "type": "inject",
        "z": "ed34b63.0ee70c8",
        "name": "Description",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "This demo creates a bubble chart showing how you could dynamically add points to the plot. It initially creates two points (100, 100 and -100, -100) to create a fixed size area for the plot.  <br><br> It then reiterates 15 times adding a point to each dataset and displaying the plot again. It also removes the animation so the points just appear on the plot.",
        "payloadType": "str",
        "x": 150,
        "y": 340,
        "wires": [
            [
                "467429fe.4d4f98"
            ]
        ]
    },
    {
        "id": "467429fe.4d4f98",
        "type": "ui_text",
        "z": "ed34b63.0ee70c8",
        "group": "ed68b86d.026b2",
        "order": 1,
        "width": "8",
        "height": "3",
        "name": "demo 3 description",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 510,
        "y": 340,
        "wires": []
    },
    {
        "id": "17a6b873.473678",
        "type": "subflow:6c259dd5.72f0d4",
        "z": "559e4b7f.0a0044",
        "name": "",
        "env": [
            {
                "name": "Buffer_Size",
                "value": "3",
                "type": "num"
            }
        ],
        "x": 490,
        "y": 300,
        "wires": [
            [
                "1d83ad72.e4e163"
            ],
            [
                "9a302b08.ce37c8"
            ]
        ]
    },
    {
        "id": "a24f670f.e53958",
        "type": "inject",
        "z": "559e4b7f.0a0044",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 290,
        "y": 300,
        "wires": [
            [
                "17a6b873.473678"
            ]
        ]
    },
    {
        "id": "1d83ad72.e4e163",
        "type": "debug",
        "z": "559e4b7f.0a0044",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 760,
        "y": 240,
        "wires": []
    },
    {
        "id": "9a302b08.ce37c8",
        "type": "debug",
        "z": "559e4b7f.0a0044",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 770,
        "y": 360,
        "wires": []
    },
    {
        "id": "47c3706.373199",
        "type": "inject",
        "z": "5f07f6ab.6224a8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "Uno",
        "payload": "",
        "payloadType": "date",
        "x": 220,
        "y": 140,
        "wires": [
            [
                "5b8df683.27b6d8"
            ]
        ]
    },
    {
        "id": "1eb06e8c.7854c1",
        "type": "inject",
        "z": "5f07f6ab.6224a8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "abcd",
        "payloadType": "str",
        "x": 240,
        "y": 240,
        "wires": [
            [
                "5b8df683.27b6d8"
            ]
        ]
    },
    {
        "id": "5b8df683.27b6d8",
        "type": "function",
        "z": "5f07f6ab.6224a8",
        "name": "",
        "func": "if(msg.topic == \"Uno\") {\n    msg.payload = 1234;\n} \nelse {\n    \n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 430,
        "y": 200,
        "wires": [
            [
                "3ca188ab.aefab8"
            ]
        ]
    },
    {
        "id": "3ca188ab.aefab8",
        "type": "debug",
        "z": "5f07f6ab.6224a8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 200,
        "wires": []
    },
    {
        "id": "8088f6b.bcc9f08",
        "type": "inject",
        "z": "1dfbd57d.bb713b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "DevKit123/led1Topic",
        "payload": "1023",
        "payloadType": "num",
        "x": 330,
        "y": 520,
        "wires": [
            [
                "f74987d8.b03fc8"
            ]
        ]
    },
    {
        "id": "f74987d8.b03fc8",
        "type": "mqtt out",
        "z": "1dfbd57d.bb713b",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "26077238.d6034e",
        "x": 670,
        "y": 400,
        "wires": []
    },
    {
        "id": "373d0382.51a90c",
        "type": "ui_slider",
        "z": "1dfbd57d.bb713b",
        "name": "",
        "label": "Led Rosso",
        "tooltip": "",
        "group": "ed4f6f2d.cb71d",
        "order": 0,
        "width": "6",
        "height": "1",
        "passthru": true,
        "outs": "all",
        "topic": "DevKit123/led1Topic",
        "topicType": "str",
        "min": 0,
        "max": "1023",
        "step": "4",
        "x": 270,
        "y": 280,
        "wires": [
            [
                "3750a0f7.f55e2"
            ]
        ]
    },
    {
        "id": "3750a0f7.f55e2",
        "type": "function",
        "z": "1dfbd57d.bb713b",
        "name": "intToStr4",
        "func": "num = msg.payload;\nmsg.payload = (\"000\" + num).slice(-4)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 440,
        "y": 280,
        "wires": [
            [
                "8d608d4b.d43e6",
                "f74987d8.b03fc8"
            ]
        ]
    },
    {
        "id": "8d608d4b.d43e6",
        "type": "debug",
        "z": "1dfbd57d.bb713b",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 280,
        "wires": []
    },
    {
        "id": "9f2f232b.df7bc",
        "type": "ui_slider",
        "z": "1dfbd57d.bb713b",
        "name": "",
        "label": "Led Giallo",
        "tooltip": "",
        "group": "ed4f6f2d.cb71d",
        "order": 0,
        "width": "6",
        "height": "1",
        "passthru": true,
        "outs": "all",
        "topic": "DevKit123/led2Topic",
        "topicType": "str",
        "min": 0,
        "max": "1023",
        "step": "4",
        "x": 260,
        "y": 420,
        "wires": [
            [
                "48f6f366.0a9c4c"
            ]
        ]
    },
    {
        "id": "48f6f366.0a9c4c",
        "type": "function",
        "z": "1dfbd57d.bb713b",
        "name": "intToStr4",
        "func": "num = msg.payload;\nmsg.payload = (\"000\" + num).slice(-4)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 440,
        "y": 420,
        "wires": [
            [
                "f74987d8.b03fc8"
            ]
        ]
    },
    {
        "id": "39a3aaf9.631d76",
        "type": "mqtt in",
        "z": "461168f8.e247f8",
        "name": "",
        "topic": "ESP32DevKit123/FFTBinTopic1",
        "qos": "0",
        "datatype": "buffer",
        "broker": "7f0dc9b.56d0038",
        "inputs": 0,
        "x": 150,
        "y": 340,
        "wires": [
            [
                "ed37fc33.a7f83"
            ]
        ]
    },
    {
        "id": "ed37fc33.a7f83",
        "type": "join",
        "z": "461168f8.e247f8",
        "name": "",
        "mode": "custom",
        "build": "buffer",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 330,
        "y": 400,
        "wires": [
            [
                "447e667a.7c33f8"
            ]
        ]
    },
    {
        "id": "447e667a.7c33f8",
        "type": "function",
        "z": "461168f8.e247f8",
        "name": "ToFloatArray1",
        "func": "// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\n\n// convert the NodeJS binary buffer into a Javascript ArrayBuffer\nmyBuffer = msg.payload.buffer;\n// put a DataView over the ArrayBuffer to make it easy to access data value\nvar dv = new DataView(myBuffer);\n\n// how many elements will be converted \nlet bytes_per_element = Float32Array.BYTES_PER_ELEMENT;\nlet byte_buffer_size = myBuffer.byteLength;\nlet number_of_element = byte_buffer_size/bytes_per_element;\n\n// create the typed array to store the converted values\nvar floatArray = new Float32Array(number_of_element);\n\n// just for debug...\n/*\nmsg.bytes_per_element = bytes_per_element;\nmsg.number_of_element = number_of_element;\nmsg.byte_length = byte_buffer_size;\n*/\n\n// iterate over the dataview and get the values\nfor (k=0, j=0; j<byte_buffer_size; k++, j=j+bytes_per_element) {\n  // all the values in the buffer are little-endian, set the optional littleEndian parameter to \"true\"\n  floatArray[k] = dv.getFloat32(j, true); \n}\n\n// this is the new payload\nmsg.payload.ch1 = floatArray;\nfloatArray = null;\ndv = null;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 540,
        "y": 400,
        "wires": [
            [
                "bddd4816.a36738"
            ]
        ]
    },
    {
        "id": "3e39851b.50227a",
        "type": "comment",
        "z": "461168f8.e247f8",
        "name": "number of blocks",
        "info": "Impostare manualmente la proprietÃ :\nAfter a number of message parts...\n\ndividendo la dimensione del messaggio per 4096",
        "x": 320,
        "y": 440,
        "wires": []
    },
    {
        "id": "bddd4816.a36738",
        "type": "function",
        "z": "461168f8.e247f8",
        "name": "Create plot information",
        "func": "// this is where you define the legend for the datasets\nvar title = \"Spettro delle ampiezze\";\nvar legend0 = \"Canale 0\";\nvar legend1 = \"Canale 1\";\n\n// variables to be used\nvar i;\n\nvar FSAMPLE = 7500; //3750;  // Samples per second\nvar FFT_SIZE = 1<<12;\n\nvar Ts = 1.0/FSAMPLE;\nvar df = 1.0 / (Ts * FFT_SIZE);\n\n// retrieve datasets from node context\nvar data0 = context.get(\"dataset0\") || {};\nvar data1 = context.get(\"dataset1\") || {};\n\nif( msg.payload.hasOwnProperty(\"ch0\") ) {\n    data0 ='';\n    for(i=0; i < msg.payload.ch0.length; i++) {\n        x = (i*df).toFixed(2);\n        y = msg.payload.ch0[i].toFixed(3);\n        data0 += \"{x: \"+x+\", y: \"+y+\"},\";\n    }\n    // this line removes the last comma to end the dataset\n    data0 = data0.replace(/^(.*),(.*?)$/, '$1');\n    // store the new dataset into node context\n    context.set(\"dataset0\", data0);\n}\n\nif( msg.payload.hasOwnProperty(\"ch1\") ) {\n    data1 ='';\n    for(i=0; i < msg.payload.ch1.length; i++) {\n        x = (i*df).toFixed(2);\n        y = msg.payload.ch1[i].toFixed(3);\n        data1 += \"{x: \"+x+\", y: \"+y+\"},\";\n    }\n    // this line removes the last comma to end the dataset\n    data1 = data1.replace(/^(.*),(.*?)$/, '$1');\n    // store the new dataset into node context\n    context.set(\"dataset1\", data1);\n}\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend0\" : legend0,\n                \"data0\"   : data0,\n                \"legend1\" : legend1,\n                \"data1\"   : data1\n};\n\ndata0 = null;\ndata1 = null;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 840,
        "y": 500,
        "wires": [
            [
                "50dcf9a0.3eade8"
            ]
        ]
    },
    {
        "id": "50dcf9a0.3eade8",
        "type": "template",
        "z": "461168f8.e247f8",
        "name": "Create the msg.template to use",
        "field": "template",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<canvas id=\"scatterChart\" width=\"800\" height=\"460\" style=\"border:1px solid #000000;margin: 2px;\"></canvas>\n\n<script>\nvar myChart = new Chart(document.getElementById(\"scatterChart\"), {\n    type: 'scatter',\n    data: {\n      datasets: [\n        {\n          label: \"{{{payload.legend0}}}\",\n          fill: false,\n          pointStyle: 'rectRot',\n          pointRadius: 2,\n          lineTension: 0,\n          pointBackgroundColor: \"rgb(220, 0, 0)\",\n          borderColor: 'rgb(255, 0, 0)',\n          data: [\n            {{{payload.data0}}}\n\n          ]\n        },\n        {\n          label: \"{{{payload.legend1}}}\",\n          fill: false,\n          pointStyle: 'circle',\n          pointRadius: 2,\n          lineTension: 0,\n          pointBackgroundColor: \"rgb(0, 220, 0)\",\n          borderColor: 'rgb(0, 255, 0)',\n          data: [\n            {{{payload.data1}}}\n\n          ]\n        }        \n      ]\n    },\n    options: {\n        animation: false,\n        fill: false,\n        legend: {\n            display: true,\n            labels: {\n                fontColor: '#444'\n            }\n        },\n        layout: {\n                padding: 10\n            },    \n        title: {\n            display: true,\n            fontColor: '#444',\n            text: '{{{payload.title}}}'\n          }, \n        scales: {\n            xAxes: [{ \n              scaleLabel: {\n                display: true,\n                fontColor: '#444',\n                labelString: \"Frequenza [Hz]\"\n              },\n              ticks: {min: 0, max:4000, tickStep: 250}\n            }],            \n            yAxes: [{ \n              scaleLabel: {\n                display: true,\n                fontColor: '#444',\n                labelString: \"Ampiezza [V]\"\n              },\n              ticks: {min: 0, max:2.5}\n            }]\n          }\n    }\n});\n\n</script>\n",
        "output": "str",
        "x": 870,
        "y": 580,
        "wires": [
            [
                "16548e8e.cf6411"
            ]
        ]
    },
    {
        "id": "16548e8e.cf6411",
        "type": "ui_template",
        "z": "461168f8.e247f8",
        "group": "b03b962e.7c4d18",
        "name": "Spettro ADS1256",
        "order": 2,
        "width": 14,
        "height": 9,
        "format": "this will be ignored",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 990,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "6a60f46b.4825fc",
        "type": "ui_text",
        "z": "461168f8.e247f8",
        "d": true,
        "group": "b03b962e.7c4d18",
        "order": 18,
        "width": 14,
        "height": 1,
        "name": "demo 1 description",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 430,
        "y": 840,
        "wires": []
    },
    {
        "id": "ffb3158e.cb79b8",
        "type": "inject",
        "z": "461168f8.e247f8",
        "d": true,
        "name": "Description",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "This demo creates a scatter chart",
        "payloadType": "str",
        "x": 150,
        "y": 840,
        "wires": [
            [
                "6a60f46b.4825fc"
            ]
        ]
    },
    {
        "id": "9607c426.69f2a8",
        "type": "function",
        "z": "461168f8.e247f8",
        "name": "ToUInt32Array",
        "func": "// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\n\n// convert the NodeJS binary buffer into a Javascript ArrayBuffer\nmyBuffer = msg.payload.buffer;\n// put a DataView over the ArrayBuffer to make it easy to access data value\nvar dv = new DataView(myBuffer);\n\n// how many elements will be converted \nlet bytes_per_element = Uint32Array.BYTES_PER_ELEMENT;\nlet byte_buffer_size = myBuffer.byteLength;\nlet number_of_element = byte_buffer_size/bytes_per_element;\n\n// create the typed array to store the converted values\nvar UIntArray = new Uint32Array(number_of_element);\n\n// just for debug...\n/*\nmsg.bytes_per_element = bytes_per_element;\nmsg.number_of_element = number_of_element;\nmsg.byte_length = byte_buffer_size;\n*/\n\n// iterate over the dataview and get the values\nfor (k=0, j=0; j<byte_buffer_size; k++, j=j+bytes_per_element) {\n  // all the values in the buffer are little-endian, set the optional littleEndian parameter to \"true\"\n  UIntArray[k] = dv.getUint32(j, true); \n}\n\n// this is the new payload\nmsg.payload = UIntArray;\nUIntArray = null;\ndv = null;\nmyBuffer = null;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 540,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "cd0f6a9b.bdcd48",
        "type": "ui_button",
        "z": "461168f8.e247f8",
        "name": "",
        "group": "b03b962e.7c4d18",
        "order": 10,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Single shot",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "1",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 170,
        "y": 920,
        "wires": [
            [
                "a64ca112.0f92b"
            ]
        ]
    },
    {
        "id": "829df21b.f8306",
        "type": "ui_button",
        "z": "461168f8.e247f8",
        "name": "",
        "group": "b03b962e.7c4d18",
        "order": 12,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Free Run",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "2",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 180,
        "y": 960,
        "wires": [
            [
                "a64ca112.0f92b"
            ]
        ]
    },
    {
        "id": "3424fd63.2c2fb2",
        "type": "ui_button",
        "z": "461168f8.e247f8",
        "name": "",
        "group": "b03b962e.7c4d18",
        "order": 14,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Stop",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "0",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 190,
        "y": 1000,
        "wires": [
            [
                "a64ca112.0f92b"
            ]
        ]
    },
    {
        "id": "a64ca112.0f92b",
        "type": "mqtt out",
        "z": "461168f8.e247f8",
        "name": "",
        "topic": "ESP32DevKit123/trigger",
        "qos": "",
        "retain": "",
        "broker": "7f0dc9b.56d0038",
        "x": 530,
        "y": 920,
        "wires": []
    },
    {
        "id": "a369ae8c.863ae",
        "type": "mqtt in",
        "z": "461168f8.e247f8",
        "name": "",
        "topic": "ESP32DevKit123/FFTBinTopic0",
        "qos": "0",
        "datatype": "buffer",
        "broker": "7f0dc9b.56d0038",
        "inputs": 0,
        "x": 150,
        "y": 540,
        "wires": [
            [
                "4a7a5e57.86c62"
            ]
        ]
    },
    {
        "id": "4a7a5e57.86c62",
        "type": "join",
        "z": "461168f8.e247f8",
        "name": "",
        "mode": "custom",
        "build": "buffer",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 310,
        "y": 600,
        "wires": [
            [
                "f0bf7a41.ffc9e8"
            ]
        ]
    },
    {
        "id": "bce115ff.15a638",
        "type": "comment",
        "z": "461168f8.e247f8",
        "name": "number of blocks",
        "info": "Impostare manualmente la proprietÃ :\nAfter a number of message parts...\n\ndividendo la dimensione del messaggio per 4096",
        "x": 300,
        "y": 640,
        "wires": []
    },
    {
        "id": "f0bf7a41.ffc9e8",
        "type": "function",
        "z": "461168f8.e247f8",
        "name": "ToFloatArray0",
        "func": "// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\n\n// convert the NodeJS binary buffer into a Javascript ArrayBuffer\nmyBuffer = msg.payload.buffer;\n// put a DataView over the ArrayBuffer to make it easy to access data value\nvar dv = new DataView(myBuffer);\n\n// how many elements will be converted \nlet bytes_per_element = Float32Array.BYTES_PER_ELEMENT;\nlet byte_buffer_size = myBuffer.byteLength;\nlet number_of_element = byte_buffer_size/bytes_per_element;\n\n// create the typed array to store the converted values\nvar floatArray = new Float32Array(number_of_element);\n\n// just for debug...\n/*\nmsg.bytes_per_element = bytes_per_element;\nmsg.number_of_element = number_of_element;\nmsg.byte_length = byte_buffer_size;\n*/\n\n// iterate over the dataview and get the values\nfor (k=0, j=0; j<byte_buffer_size; k++, j=j+bytes_per_element) {\n  // all the values in the buffer are little-endian, set the optional littleEndian parameter to \"true\"\n  floatArray[k] = dv.getFloat32(j, true); \n}\n\n// this is the new payload\nmsg.payload.ch0 = floatArray;\nfloatArray = null;\ndv = null;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 540,
        "y": 600,
        "wires": [
            [
                "bddd4816.a36738"
            ]
        ]
    },
    {
        "id": "5d7f418f.36a81",
        "type": "comment",
        "z": "461168f8.e247f8",
        "name": "Nota",
        "info": "Da usare se i dati binari sono valori di tipo Int",
        "x": 520,
        "y": 240,
        "wires": []
    },
    {
        "id": "bb87d88c.7bd868",
        "type": "status",
        "z": "461168f8.e247f8",
        "name": "",
        "scope": [
            "39a3aaf9.631d76",
            "a369ae8c.863ae"
        ],
        "x": 100,
        "y": 100,
        "wires": [
            [
                "d7591e66.5b674"
            ]
        ]
    },
    {
        "id": "6fd5f0d0.6bc05",
        "type": "ui_text",
        "z": "461168f8.e247f8",
        "group": "b03b962e.7c4d18",
        "order": 16,
        "width": 14,
        "height": 1,
        "name": "",
        "label": "MQTT status:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "x": 920,
        "y": 60,
        "wires": []
    },
    {
        "id": "d7591e66.5b674",
        "type": "function",
        "z": "461168f8.e247f8",
        "name": "Store_mqtt_status",
        "func": "var mqtt_status=msg.status;\nflow.set(\"mqtt_status\",mqtt_status);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 310,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "f6fae718.e66068",
        "type": "function",
        "z": "461168f8.e247f8",
        "name": "Get_mqtt_status",
        "func": "var status = flow.get(\"mqtt_status\") || {};\n\nif (status.text==\"node-red:common.status.connected\")\n{\n  msg.payload = \"Connected\";\n}\nelse if (status.text==\"node-red:common.status.connecting\")\n{\n  msg.payload = \"Connecting...\";\n}\nelse if (status.text==\"node-red:common.status.disconnected\") {\n  msg.payload = \"Disconnected\";    \n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 720,
        "y": 60,
        "wires": [
            [
                "6fd5f0d0.6bc05"
            ]
        ]
    },
    {
        "id": "850e0abe.d59748",
        "type": "inject",
        "z": "461168f8.e247f8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "2",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 530,
        "y": 60,
        "wires": [
            [
                "f6fae718.e66068"
            ]
        ]
    },
    {
        "id": "68356cd8.9130fc",
        "type": "mqtt in",
        "z": "461168f8.e247f8",
        "name": "",
        "topic": "ESP32DevKit123/RTD1BinTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "7f0dc9b.56d0038",
        "inputs": 0,
        "x": 170,
        "y": 1120,
        "wires": [
            [
                "e79a2285.e63ae8"
            ]
        ]
    },
    {
        "id": "cc7913fd.cdef88",
        "type": "mqtt in",
        "z": "461168f8.e247f8",
        "name": "",
        "topic": "ESP32DevKit123/RTD2BinTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "7f0dc9b.56d0038",
        "inputs": 0,
        "x": 170,
        "y": 1180,
        "wires": [
            [
                "af323395.450a7"
            ]
        ]
    },
    {
        "id": "e9290588.dceb38",
        "type": "mqtt in",
        "z": "461168f8.e247f8",
        "name": "",
        "topic": "ESP32DevKit123/CountAdcTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "7f0dc9b.56d0038",
        "inputs": 0,
        "x": 170,
        "y": 1240,
        "wires": [
            [
                "79064829.2a56d8"
            ]
        ]
    },
    {
        "id": "e79a2285.e63ae8",
        "type": "ui_gauge",
        "z": "461168f8.e247f8",
        "name": "",
        "group": "b03b962e.7c4d18",
        "order": 1,
        "width": 2,
        "height": 2,
        "gtype": "gage",
        "title": "RTD1",
        "label": "Â°C",
        "format": "{{value | number:2}}",
        "min": 0,
        "max": "50",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 450,
        "y": 1120,
        "wires": []
    },
    {
        "id": "af323395.450a7",
        "type": "ui_gauge",
        "z": "461168f8.e247f8",
        "name": "",
        "group": "b03b962e.7c4d18",
        "order": 3,
        "width": 2,
        "height": 2,
        "gtype": "gage",
        "title": "RTD2",
        "label": "Â°C",
        "format": "{{value | number:2}}",
        "min": 0,
        "max": "50",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 450,
        "y": 1180,
        "wires": []
    },
    {
        "id": "79064829.2a56d8",
        "type": "debug",
        "z": "461168f8.e247f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 470,
        "y": 1240,
        "wires": []
    },
    {
        "id": "606a7a27.f6b674",
        "type": "mqtt in",
        "z": "24046517.06b45a",
        "name": "",
        "topic": "ESP32DevKit123/FFTBinTopic1",
        "qos": "0",
        "datatype": "buffer",
        "broker": "35a4e7d1.620608",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 150,
        "y": 400,
        "wires": [
            [
                "94056176.d1a9b"
            ]
        ]
    },
    {
        "id": "aba739df.e66248",
        "type": "debug",
        "z": "24046517.06b45a",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 250,
        "y": 100,
        "wires": []
    },
    {
        "id": "8490989f.36ecb8",
        "type": "file",
        "z": "24046517.06b45a",
        "d": true,
        "name": "",
        "filename": "C:\\Users\\luca\\Documents\\PlatformIO\\Projects\\ESP32_Devkit_ADS1256_FFT_AsyncMQTT_binary_01\\ricevuto.txt",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1230,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "94056176.d1a9b",
        "type": "join",
        "z": "24046517.06b45a",
        "name": "",
        "mode": "custom",
        "build": "buffer",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 370,
        "y": 400,
        "wires": [
            [
                "b3529547.db76e8"
            ]
        ]
    },
    {
        "id": "b3529547.db76e8",
        "type": "function",
        "z": "24046517.06b45a",
        "name": "ToFloatArray1",
        "func": "// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\n// https://stackoverflow.com/questions/8609289/convert-a-binary-nodejs-buffer-to-javascript-arraybuffer/31394257#31394257\n\n// convert the NodeJS binary buffer into a Javascript ArrayBuffer\nlet b = msg.payload;\nlet myBuffer = b.buffer.slice(b.byteOffset, b.byteOffset + b.byteLength);\n\n//// convert the NodeJS binary buffer into a Javascript ArrayBuffer\n//myBuffer = msg.payload.buffer;\n\n// put a DataView over the ArrayBuffer to make it easy to access data value\nvar dv = new DataView(myBuffer);\n\n// how many elements will be converted \nlet bytes_per_element = Float32Array.BYTES_PER_ELEMENT;\nlet byte_buffer_size = myBuffer.byteLength;\nlet number_of_element = byte_buffer_size/bytes_per_element;\n\n// create the typed array to store the converted values\nvar floatArray = new Float32Array(number_of_element);\n\n// just for debug...\n/*\nmsg.bytes_per_element = bytes_per_element;\nmsg.number_of_element = number_of_element;\nmsg.byte_length = byte_buffer_size;\n*/\n\n// iterate over the dataview and get the values\nfor (k=0, j=0; j<byte_buffer_size; k++, j=j+bytes_per_element) {\n  // all the values in the buffer are little-endian, set the optional littleEndian parameter to \"true\"\n  floatArray[k] = dv.getFloat32(j, true); \n}\n\n// this is the new payload\nmsg.payload.ch1 = floatArray;\nfloatArray = [];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 540,
        "y": 400,
        "wires": [
            [
                "ca73275d.02e458",
                "1f7df9f9.b33416"
            ]
        ],
        "info": "// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/"
    },
    {
        "id": "d7472be0.4a5178",
        "type": "comment",
        "z": "24046517.06b45a",
        "name": "number of blocks",
        "info": "Impostare manualmente la proprietÃ :\nAfter a number of message parts...\n\ndividendo la dimensione del messaggio per 4096",
        "x": 360,
        "y": 440,
        "wires": []
    },
    {
        "id": "ca73275d.02e458",
        "type": "function",
        "z": "24046517.06b45a",
        "name": "Create plot information",
        "func": "// get FFT parameters\nvar FSAMPLE = flow.get(\"FSAMPLE\") || 7500; //3750;  // Samples per second\nvar FFT_SIZE = flow.get(\"FFT_SIZE\") || 1<<12;\n\nvar Ts = 1.0/FSAMPLE;\nvar df = 1.0 / (Ts * FFT_SIZE);\n\n// this is where you define the legend for the datasets\nvar title = \"Spettro delle ampiezze\";\nvar legend0 = \"Canale 0\";\nvar legend1 = \"Canale 1\";\n\n// variables to be used\nvar i;\nvar m;\n\n// retrieve datasets from node context\nvar data0 = context.get(\"dataset0\") || [];\nvar data1 = context.get(\"dataset1\") || [];\nvar equalizer = flow.get(\"EQUALIZER\") || [];\n\nvar eq_def = (equalizer.length > 0);\n\nif( msg.payload.hasOwnProperty(\"ch0\") ) {\n    data0 =[];\n    \n    for(i=0; i < msg.payload.ch0.length; i++) {\n       m = (eq_def) ? equalizer[i] : 1.0;\n       data0.push( {\"x\": i*df, \"y\": m * msg.payload.ch0[i] } );\n    }\n    \n    // store the new dataset into node context\n    context.set(\"dataset0\", data0);\n}\n\nif( msg.payload.hasOwnProperty(\"ch1\") ) {\n    data1 =[];\n    \n    for(i=0; i < msg.payload.ch1.length; i++) {\n      m = (eq_def) ? equalizer[i] : 1.0;\n      data1.push( {\"x\": i*df, \"y\": m * msg.payload.ch1[i] } );\n    }\n    \n    // store the new dataset into node context\n    context.set(\"dataset1\", data1);\n}\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend0\" : legend0,\n                \"data0\"   : data0,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                \"df\"      : df\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 800,
        "y": 460,
        "wires": [
            [
                "1ac17e61.b3a592",
                "a09bd4f3.ec2928",
                "d88b769ecd8b28a8"
            ]
        ]
    },
    {
        "id": "5a95e2f2.458fcc",
        "type": "inject",
        "z": "24046517.06b45a",
        "d": true,
        "name": "Description",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "This demo creates a scatter chart",
        "payloadType": "str",
        "x": 150,
        "y": 840,
        "wires": [
            [
                "bb5c140.f5ad4e8"
            ]
        ]
    },
    {
        "id": "d6b73d90.774d2",
        "type": "function",
        "z": "24046517.06b45a",
        "d": true,
        "name": "ToUInt32Array",
        "func": "// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\n\n// convert the NodeJS binary buffer into a Javascript ArrayBuffer\nmyBuffer = msg.payload.buffer;\n// put a DataView over the ArrayBuffer to make it easy to access data value\nvar dv = new DataView(myBuffer);\n\n// how many elements will be converted \nlet bytes_per_element = Uint32Array.BYTES_PER_ELEMENT;\nlet byte_buffer_size = myBuffer.byteLength;\nlet number_of_element = byte_buffer_size/bytes_per_element;\n\n// create the typed array to store the converted values\nvar UIntArray = new Uint32Array(number_of_element);\n\n// just for debug...\n/*\nmsg.bytes_per_element = bytes_per_element;\nmsg.number_of_element = number_of_element;\nmsg.byte_length = byte_buffer_size;\n*/\n\n// iterate over the dataview and get the values\nfor (k=0, j=0; j<byte_buffer_size; k++, j=j+bytes_per_element) {\n  // all the values in the buffer are little-endian, set the optional littleEndian parameter to \"true\"\n  UIntArray[k] = dv.getUint32(j, true); \n}\n\n// this is the new payload\nmsg.payload = UIntArray;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 720,
        "y": 180,
        "wires": [
            [
                "8490989f.36ecb8"
            ]
        ]
    },
    {
        "id": "70fc0b1f.93e744",
        "type": "mqtt out",
        "z": "24046517.06b45a",
        "name": "",
        "topic": "ESP32DevKit123/trigger",
        "qos": "",
        "retain": "",
        "broker": "35a4e7d1.620608",
        "x": 530,
        "y": 920,
        "wires": []
    },
    {
        "id": "1ac17e61.b3a592",
        "type": "file",
        "z": "24046517.06b45a",
        "name": "",
        "filename": "C:\\Users\\luca\\Documents\\PlatformIO\\Projects\\ESP32_Devkit_ADS1256_FFT_AsyncMQTT_binary_01\\dati_chart.txt",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 790,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "557cf47f.2deb3c",
        "type": "mqtt in",
        "z": "24046517.06b45a",
        "name": "",
        "topic": "ESP32DevKit123/FFTBinTopic0",
        "qos": "0",
        "datatype": "buffer",
        "broker": "35a4e7d1.620608",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 150,
        "y": 520,
        "wires": [
            [
                "90c7c1bf.64111"
            ]
        ]
    },
    {
        "id": "90c7c1bf.64111",
        "type": "join",
        "z": "24046517.06b45a",
        "name": "",
        "mode": "custom",
        "build": "buffer",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 370,
        "y": 520,
        "wires": [
            [
                "29bd91ff.8546ae"
            ]
        ]
    },
    {
        "id": "462db907.e7aeb8",
        "type": "comment",
        "z": "24046517.06b45a",
        "name": "number of blocks",
        "info": "Impostare manualmente la proprietÃ :\nAfter a number of message parts...\n\ndividendo la dimensione del messaggio per 4096",
        "x": 360,
        "y": 560,
        "wires": []
    },
    {
        "id": "29bd91ff.8546ae",
        "type": "function",
        "z": "24046517.06b45a",
        "name": "ToFloatArray0",
        "func": "// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\n// https://stackoverflow.com/questions/8609289/convert-a-binary-nodejs-buffer-to-javascript-arraybuffer/31394257#31394257\n\n// convert the NodeJS binary buffer into a Javascript ArrayBuffer\nlet b = msg.payload;\nlet myBuffer = b.buffer.slice(b.byteOffset, b.byteOffset + b.byteLength);\n\n//// convert the NodeJS binary buffer into a Javascript ArrayBuffer\n//myBuffer = msg.payload.buffer;\n\n// put a DataView over the ArrayBuffer to make it easy to access data value\nvar dv = new DataView(myBuffer);\n\n// how many elements will be converted \nlet bytes_per_element = Float32Array.BYTES_PER_ELEMENT;\nlet byte_buffer_size = myBuffer.byteLength;\nlet number_of_element = byte_buffer_size/bytes_per_element;\n\n// create the typed array to store the converted values\nvar floatArray = new Float32Array(number_of_element);\n\n// just for debug...\n/*\nmsg.bytes_per_element = bytes_per_element;\nmsg.number_of_element = number_of_element;\nmsg.byte_length = byte_buffer_size;\n*/\n\n// iterate over the dataview and get the values\nfor (k=0, j=0; j<byte_buffer_size; k++, j=j+bytes_per_element) {\n  // all the values in the buffer are little-endian, set the optional littleEndian parameter to \"true\"\n  floatArray[k] = dv.getFloat32(j, true); \n}\n\n// this is the new payload\nmsg.payload.ch0 = floatArray;\nfloatArray = [];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 540,
        "y": 520,
        "wires": [
            [
                "ca73275d.02e458"
            ]
        ]
    },
    {
        "id": "9f558fe1.ebcc2",
        "type": "status",
        "z": "24046517.06b45a",
        "name": "",
        "scope": [
            "606a7a27.f6b674"
        ],
        "x": 80,
        "y": 60,
        "wires": [
            [
                "810a2b1f.26f2a8",
                "aba739df.e66248"
            ]
        ]
    },
    {
        "id": "82bf57e.7f346a8",
        "type": "function",
        "z": "24046517.06b45a",
        "name": "Get_mqtt_status",
        "func": "var status = flow.get(\"mqtt_status\") || {};\n\nif (status.text==\"node-red:common.status.connected\")\n{\n  msg.payload = \"Connected\";\n}\nelse if (status.text==\"node-red:common.status.connecting\")\n{\n  msg.payload = \"Connecting...\";\n}\nelse if (status.text==\"node-red:common.status.disconnected\") {\n  msg.payload = \"Disconnected\";    \n}\nelse {\n    msg.payload = \"a\";\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 700,
        "y": 60,
        "wires": [
            [
                "ca0a4a9b.1a0028",
                "8bf09edb.79f81"
            ]
        ]
    },
    {
        "id": "810a2b1f.26f2a8",
        "type": "function",
        "z": "24046517.06b45a",
        "name": "Store_mqtt_status",
        "func": "var mqtt_status=msg.status;\nflow.set(\"mqtt_status\",mqtt_status);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 290,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "ca0a4a9b.1a0028",
        "type": "debug",
        "z": "24046517.06b45a",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 890,
        "y": 100,
        "wires": []
    },
    {
        "id": "8e887b8b.81f6f8",
        "type": "inject",
        "z": "24046517.06b45a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "2",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 510,
        "y": 60,
        "wires": [
            [
                "82bf57e.7f346a8"
            ]
        ]
    },
    {
        "id": "6d807a52.9751c4",
        "type": "mqtt in",
        "z": "24046517.06b45a",
        "name": "",
        "topic": "ESP32DevKit123/RTD1BinTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "35a4e7d1.620608",
        "inputs": 0,
        "x": 170,
        "y": 1240,
        "wires": [
            [
                "680e0e98.e4971"
            ]
        ]
    },
    {
        "id": "e2c87803.9d4808",
        "type": "function",
        "z": "24046517.06b45a",
        "name": "RTD_float",
        "func": "// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\n\n//var fbuffer = new ArrayBuffer(4);\n//new DataView(fbuffer).setFloat32(0, 1.0, true /* littleEndian */);\n\n//fbuffer = msg.payload.buffer;\n//const view = new DataView(fbuffer);\n/*\nvar ab = new ArrayBuffer(msg.payload.length);\n//const view = new Float32Array(ab);\n\n    for (let i = 0; i < msg.payload.length; i++) {\n        ab[i] = msg.payload[i];\n    }\n\nvar dv = new DataView(ab);\n//msg.payload.rtd1 = new Float32Array(msg.payload)[0];\nmsg.payload.rtd1 = dv.getFloat32(0, true);\n//msg.payload.rtd1 = msg.payload.byteLength;\n*/\n\nlet b = msg.payload;\nlet f32 = new Float32Array(b.buffer, 0, b.byteLength / Float32Array.BYTES_PER_ELEMENT);\nmsg.payload = f32[0];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 470,
        "y": 1120,
        "wires": [
            [
                "f936d8ed.040368"
            ]
        ]
    },
    {
        "id": "f936d8ed.040368",
        "type": "debug",
        "z": "24046517.06b45a",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 1120,
        "wires": []
    },
    {
        "id": "cb28a49d.d483f8",
        "type": "debug",
        "z": "24046517.06b45a",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 750,
        "y": 260,
        "wires": []
    },
    {
        "id": "5513dc8e.679a44",
        "type": "mqtt in",
        "z": "24046517.06b45a",
        "name": "",
        "topic": "ESP32DevKit123/RTD2BinTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "35a4e7d1.620608",
        "inputs": 0,
        "x": 170,
        "y": 1360,
        "wires": [
            [
                "23f11bef.3588e4"
            ]
        ]
    },
    {
        "id": "c33813b9.f132b",
        "type": "mqtt in",
        "z": "24046517.06b45a",
        "name": "",
        "topic": "ESP32DevKit123/CountAdcTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "35a4e7d1.620608",
        "inputs": 0,
        "x": 170,
        "y": 1480,
        "wires": [
            [
                "ba43cd7e821460b5"
            ]
        ]
    },
    {
        "id": "1f7df9f9.b33416",
        "type": "debug",
        "z": "24046517.06b45a",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 400,
        "wires": []
    },
    {
        "id": "7ec0b691.f39fb8",
        "type": "inject",
        "z": "24046517.06b45a",
        "name": "Create parameters",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 260,
        "wires": [
            [
                "a357c2bb.957cb"
            ]
        ]
    },
    {
        "id": "a357c2bb.957cb",
        "type": "function",
        "z": "24046517.06b45a",
        "name": "Set parameters",
        "func": "var FSAMPLE = 7500; //3750;  // Samples per second\nvar FFT_SIZE = 1<<12;        // FFT size (must be a power of two)\nvar MCP_SAMPLE_PERIOD = 10e-3;\n\nflow.set(\"FSAMPLE\", FSAMPLE);\nflow.set(\"FFT_SIZE\", FFT_SIZE);\nflow.set(\"MCP_SAMPLE_PERIOD\", MCP_SAMPLE_PERIOD);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 320,
        "y": 260,
        "wires": [
            [
                "d4248d7e.0eb9e"
            ]
        ]
    },
    {
        "id": "d4248d7e.0eb9e",
        "type": "function",
        "z": "24046517.06b45a",
        "name": "ADC sinc equalizer",
        "func": "// precompute the overall frequency response for the ADS1255/6\n// see: ADS1256.pdf, page 18 equation 2\nvar FSAMPLE = flow.get(\"FSAMPLE\") || 7500;\nvar FFT_SIZE = flow.get(\"FFT_SIZE\")|| 2<<11;\nvar len = FFT_SIZE / 2;\nvar Num_Ave = 4;\nvar Ts = 1.0/FSAMPLE;        // sample period\nvar df = 1.0 / (Ts * FFT_SIZE);  // FFT frequency resolution\nvar F_CLKIN = 7.68e6;\nvar I_F_CLKIN = 1 / F_CLKIN;\nvar pi = Math.PI;\nvar i;\nvar R_lp = 1e2;\nvar C_lp = 180e-9;\nvar tau_lp = R_lp * C_lp;\nvar f_lp = (1/tau_lp)/(2*pi);\n\n// create the typed array to store the converted values\nvar equalizer = new Float32Array(len);\n\nfor(i=0; i<len; i++) {\n    var f = i * df;\n    var f_n = f * I_F_CLKIN;\n    var n1 = Math.sin(256*pi*f_n);\n    var d1 = 64 * Math.sin(4 * pi * f_n);\n    var n2 = Math.sin( 256 * pi * Num_Ave * f_n);\n    var d2 = Num_Ave * Math.sin( 256 * pi * f_n);\n    \n    var H_sinc = Math.abs( n1 / d1  )**5;\n    var H_averager = Math.abs(n2/d2);\n    var p = H_sinc * H_averager / Math.sqrt(1 + (f/f_lp)**2 );\n    // se p == 0, assegna 1 di default\n    p = 1.0;\n    equalizer[i] = (p > 0)  ? 1.0 / p : 1.0;\n}\n\nflow.set(\"EQUALIZER\", equalizer);\nmsg.df = df;\nmsg.payload=equalizer;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 530,
        "y": 260,
        "wires": [
            [
                "cb28a49d.d483f8"
            ]
        ]
    },
    {
        "id": "ad85aa53.1ef878",
        "type": "mqtt in",
        "z": "24046517.06b45a",
        "name": "",
        "topic": "ESP32DevKit123/RTD1FaultTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "35a4e7d1.620608",
        "inputs": 0,
        "x": 180,
        "y": 1300,
        "wires": [
            [
                "19138ca6.c9a8e3"
            ]
        ]
    },
    {
        "id": "19138ca6.c9a8e3",
        "type": "ui_text",
        "z": "24046517.06b45a",
        "group": "b03b962e.7c4d18",
        "order": 19,
        "width": 7,
        "height": 1,
        "name": "",
        "label": "RTD1 status:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "x": 710,
        "y": 1300,
        "wires": []
    },
    {
        "id": "8c1c3e73.19a99",
        "type": "mqtt in",
        "z": "24046517.06b45a",
        "name": "",
        "topic": "ESP32DevKit123/RTD2FaultTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "35a4e7d1.620608",
        "inputs": 0,
        "x": 180,
        "y": 1420,
        "wires": [
            [
                "4f9a9b2d.69ef44"
            ]
        ]
    },
    {
        "id": "4f9a9b2d.69ef44",
        "type": "ui_text",
        "z": "24046517.06b45a",
        "group": "b03b962e.7c4d18",
        "order": 20,
        "width": 7,
        "height": 1,
        "name": "",
        "label": "RTD2 status:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "x": 710,
        "y": 1420,
        "wires": []
    },
    {
        "id": "23f11bef.3588e4",
        "type": "ui_gauge",
        "z": "24046517.06b45a",
        "name": "rtd2",
        "group": "b03b962e.7c4d18",
        "order": 4,
        "width": 2,
        "height": 2,
        "gtype": "gage",
        "title": "RTD2",
        "label": "Â°C",
        "format": "{{value | number:2}}",
        "min": 0,
        "max": "50",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 470,
        "y": 1360,
        "wires": []
    },
    {
        "id": "680e0e98.e4971",
        "type": "ui_gauge",
        "z": "24046517.06b45a",
        "name": "rtd1",
        "group": "b03b962e.7c4d18",
        "order": 1,
        "width": 2,
        "height": 2,
        "gtype": "gage",
        "title": "RTD1",
        "label": "Â°C",
        "format": "{{value | number:2}}",
        "min": 0,
        "max": "50",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 470,
        "y": 1240,
        "wires": []
    },
    {
        "id": "a09bd4f3.ec2928",
        "type": "ui_template",
        "z": "24046517.06b45a",
        "group": "b03b962e.7c4d18",
        "name": "Spettro ADS1256",
        "order": 2,
        "width": 14,
        "height": 8,
        "format": "<canvas id=\"scatterChart\" width=\"750\" height=\"400\" style=\"border:1px solid #000000;margin: 2px;\"></canvas>\n\n<script>\n(function() {\n    var chartID = \"scatterChart\";           // set this to the id you have specified in the canvas tag above\n\n    // setup the chart definition as defined in the chart.js documentation, \n    // in addition setting up the topic for each channel\n    var chartDef = {\n        type: 'scatter',\n        data: {\n          datasets: [\n            {\n              label: \"\",\n              fill: false,\n              pointStyle: 'rectRot',\n              pointRadius: 2,\n              lineTension: 0,\n              pointBackgroundColor: \"rgb(220, 0, 0)\",\n              borderColor: 'rgb(255, 0, 0)',\n              data: []  // data is written here later\n            },\n            {\n              label: \"\",\n              fill: false,\n              pointStyle: 'circle',\n              pointRadius: 2,\n              lineTension: 0,\n              pointBackgroundColor: \"rgb(0, 220, 0)\",\n              borderColor: 'rgb(0, 255, 0)',\n              data: []  // data is written here later\n            }        \n          ]\n        }, \n        options: {\n            animation: false,\n            fill: false,\n            tooltips: {\n                callbacks: {\n                    label: function (tooltipItem, data) {\n                        return Number(tooltipItem.xLabel).toFixed(2) +\"Hz, \" + Number(tooltipItem.yLabel).toFixed(3) + \"V\";\n                    }\n                }\n            },\n            legend: {\n                display: true,\n                labels: {\n                    fontColor: '#444'\n                }\n            },\n            layout: {\n                    padding: 10\n            },    \n            title: {\n                text: 'Accelerazioni',\n                display: true,\n                fontColor: '#444'\n            }, \n            scales: {\n                xAxes: [{ \n                  scaleLabel: {\n                    display: true,\n                    fontColor: '#444',\n                    labelString: \"Frequenza [Hz]\"\n                  },\n                  ticks: {min: 0, max:4000, tickStep: 250}\n                }],            \n                yAxes: [{ \n                  scaleLabel: {\n                    display: true,\n                    fontColor: '#444',\n                    labelString: \"Ampiezza [V]\"\n                  },\n                  ticks: {min: 0, max:2.5}\n                }]\n            }\n        }\n    };\n    \n    var myChart = null;\n    \n    function doChart(msg, scope) {\n        //var title = msg.payload.title;\n        var title = msg.payload.legend1;\n        \n        console.log(\"data 0:\");\n        console.log(msg.payload.data0);\n        if( msg.payload.data1.length > 0  ) {\n        console.log(\"data 1:\");\n        console.log(msg.payload.data1);\n        }\n        \n        if (!myChart) {\n            // chart does not exist so load the data and create it\n            var ctx = document.getElementById(chartID);\n            myChart = new Chart(ctx, chartDef); \n            \n            myChart.options.title.text = msg.payload.title;\n            \n            myChart.data.datasets[0].label = msg.payload.legend0;\n            myChart.data.datasets[1].label = msg.payload.legend1;\n        }\n\n\n        if( msg.payload.data0.length > 0  ) {\n            for(k=0; k<msg.payload.data0.length; k++) {\n              myChart.data.datasets[0].data.pop();\n            }\n           // myChart.update();\n            for(k=0; k<msg.payload.data0.length; k++) {\n              myChart.data.datasets[0].data.push( msg.payload.data0[k] );\n            }\n            myChart.update();\n        }        \n        \n        //myChart.data.datasets[1].data.push( dati1 );\n        if( msg.payload.data1.length > 0  ) {\n            for(k=0; k<msg.payload.data1.length; k++) {\n              myChart.data.datasets[1].data.pop();\n            }\n           // myChart.update();\n            for(k=0; k<msg.payload.data1.length; k++) {\n              myChart.data.datasets[1].data.push( msg.payload.data1[k] );\n            }\n            myChart.update();\n        }\n        \n        \n        // and update chart\n       // myChart.update();\n        \n    }\n    \n    (function(scope) {\n        // this code gets run when the a view is opened on the node in the browser\n        scope.$watch('msg', function(msg) {\n            if (msg) {\n                doChart(msg, scope);\n            }\n        });\n    })(scope);    \n    \n})();\n</script>\n",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 1070,
        "y": 460,
        "wires": [
            []
        ],
        "info": "decimals in tooltips:\nhttps://social.msdn.microsoft.com/Forums/en-US/64911138-1dad-4534-ad07-e789f4550d56/chartjs-plot-decimal-points"
    },
    {
        "id": "6e66ea79.5b0fe4",
        "type": "ui_button",
        "z": "24046517.06b45a",
        "name": "",
        "group": "b03b962e.7c4d18",
        "order": 12,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Single shot",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "1",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 150,
        "y": 920,
        "wires": [
            [
                "70fc0b1f.93e744"
            ]
        ]
    },
    {
        "id": "c946ccc1.6f519",
        "type": "ui_button",
        "z": "24046517.06b45a",
        "name": "",
        "group": "b03b962e.7c4d18",
        "order": 14,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Free Run",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "2",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 160,
        "y": 960,
        "wires": [
            [
                "70fc0b1f.93e744"
            ]
        ]
    },
    {
        "id": "38465d3f.9409e2",
        "type": "ui_button",
        "z": "24046517.06b45a",
        "name": "",
        "group": "b03b962e.7c4d18",
        "order": 16,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Stop",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "0",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 170,
        "y": 1000,
        "wires": [
            [
                "70fc0b1f.93e744"
            ]
        ]
    },
    {
        "id": "bb5c140.f5ad4e8",
        "type": "ui_text",
        "z": "24046517.06b45a",
        "d": true,
        "group": "b03b962e.7c4d18",
        "order": 22,
        "width": 14,
        "height": 1,
        "name": "demo 1 description",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 510,
        "y": 840,
        "wires": []
    },
    {
        "id": "8bf09edb.79f81",
        "type": "ui_text",
        "z": "24046517.06b45a",
        "group": "b03b962e.7c4d18",
        "order": 18,
        "width": 8,
        "height": 1,
        "name": "MQTT status",
        "label": "MQTT status:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "x": 910,
        "y": 60,
        "wires": []
    },
    {
        "id": "e1ed4d9a.4be8f",
        "type": "mqtt in",
        "z": "24046517.06b45a",
        "name": "",
        "topic": "ESP32DevKit123/TorqueSpeedTopic",
        "qos": "0",
        "datatype": "buffer",
        "broker": "35a4e7d1.620608",
        "inputs": 0,
        "x": 180,
        "y": 1580,
        "wires": [
            [
                "6435727b.c3e3ec"
            ]
        ]
    },
    {
        "id": "6435727b.c3e3ec",
        "type": "function",
        "z": "24046517.06b45a",
        "name": "ToMCPPoints",
        "func": "// get MCP3204 parameters\nvar Ts = flow.get(\"MCP_SAMPLE_PERIOD\") || 10e-3;\n\n// this is where you define the legend for the datasets\nvar title1 = \"Coppie meccaniche\";\nvar title2 = \"VelocitÃ \";\nvar legend0 = \"Coppia 1\";\nvar legend1 = \"Coppia 2\";\nvar legend2 = \"VelocitÃ  1\";\nvar legend3 = \"VelocitÃ  2\";\n\n// variables to be used\nvar i;\nvar data0 = [];\nvar data1 = [];\nvar data2 = [];\nvar data3 = [];\n\n// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\n// https://stackoverflow.com/questions/8609289/convert-a-binary-nodejs-buffer-to-javascript-arraybuffer/31394257#31394257\n\n// convert the NodeJS binary buffer into a Javascript ArrayBuffer\nlet b = msg.payload;\nlet mcpBuffer = b.buffer.slice(b.byteOffset, b.byteOffset + b.byteLength);\n\n// put a DataView over the ArrayBuffer to make it easy to access data value\nvar dv = new DataView(mcpBuffer);\n\n// how many elements will be converted \nlet bytes_per_element1 = Float32Array.BYTES_PER_ELEMENT;\nvar byte_buffer_size1 =  mcpBuffer.byteLength;\nvar number_of_element1 = byte_buffer_size1/bytes_per_element1;\n\n// samples per channel\nvar samples_per_channel = number_of_element1/4;\n\n// create the typed array to store the converted values\nvar floatArray1 = new Float32Array(number_of_element1);\n\n// just for debug...\n/*\nmsg.bytes_per_element1 = bytes_per_element1;\nmsg.number_of_element1 = number_of_element1;\nmsg.byte_buffer_size1 = mcpBuffer.byteLength;\n*/\n// iterate over the dataview and get the values\nfor (k=0, j=0; j<byte_buffer_size1; k++, j=j+bytes_per_element1) {\n  // all the values in the buffer are little-endian, set the optional littleEndian parameter to \"true\"\n  floatArray1[k] = dv.getFloat32(j, true); \n}\n\n// split the floatArray into four datasets\ndata0 = floatArray1.slice(0, samples_per_channel);\ndata1 = floatArray1.slice(samples_per_channel, 2*samples_per_channel);\ndata2 = floatArray1.slice(2*samples_per_channel, 3*samples_per_channel);\ndata3 = floatArray1.slice(3*samples_per_channel, 4*samples_per_channel);\n\n//console.log(data0);\n//console.log(data1);\n\nvar points0 = [];\nvar points1 = [];\nvar points2 = [];\nvar points3 = [];\n\nfor(i=0; i < samples_per_channel; i++) {\n   points0.push( {\"x\": i*Ts, \"y\": data0[i] } );\n}\n\nfor(i=0; i < samples_per_channel; i++) {\n   points1.push( {\"x\": i*Ts, \"y\": data1[i] } );\n} \n\nfor(i=0; i < samples_per_channel; i++) {\n   points2.push( {\"x\": i*Ts, \"y\": data2[i] } );\n}\n\nfor(i=0; i < samples_per_channel; i++) {\n   points3.push( {\"x\": i*Ts, \"y\": data3[i] } );\n}\n\n//console.log(points0);\n//console.log(points1);\n\n// Now we build msg1.payload\nvar msg1 = { payload: {} };\nmsg1.payload = { \"title\"   : title1,\n                \"legend0\" : legend0,\n                \"data0\"   : points0,\n                \"legend1\" : legend1,\n                \"data1\"   : points1,\n                \"Ts\"      : Ts\n};\n\n// Now we build msg2.payload\nvar msg2 = { payload: {} };\nmsg2.payload = { \"title\"   : title2,\n                \"legend0\" : legend2,\n                \"data0\"   : points2,\n                \"legend1\" : legend3,\n                \"data1\"   : points3,\n                \"Ts\"      : Ts\n};\n\nreturn [msg1, msg2];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 440,
        "y": 1580,
        "wires": [
            [
                "a8cd164e9bb93553"
            ],
            [
                "920309c211b4edb3"
            ]
        ],
        "info": "https://stackoverflow.com/questions/8609289/convert-a-binary-nodejs-buffer-to-javascript-arraybuffer\n...\nThe slice and offset stuff is required because small Buffers (less than 4 kB by default, half the [pool size](https://nodejs.org/dist/latest-v12.x/docs/api/buffer.html#buffer_class_property_buffer_poolsize)) can be views on a shared ArrayBuffer. Without slicing, you can end up with an ArrayBuffer containing data from another Buffer. See explanation [in the docs](https://nodejs.org/dist/latest-v12.x/docs/api/buffer.html#buffer_buf_byteoffset)."
    },
    {
        "id": "d88b769ecd8b28a8",
        "type": "debug",
        "z": "24046517.06b45a",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1070,
        "y": 580,
        "wires": []
    },
    {
        "id": "a8cd164e9bb93553",
        "type": "ui_template",
        "z": "24046517.06b45a",
        "group": "b03b962e.7c4d18",
        "name": "Coppie",
        "order": 3,
        "width": 8,
        "height": 5,
        "format": "<canvas id=\"TorqueChart\" width=\"300\" height=\"170\" style=\"border:1px solid #000000;margin: 2px;\"></canvas>\n\n<script>\n(function() {\n    var chartID = \"TorqueChart\";           // set this to the id you have specified in the canvas tag above\n\n    // setup the chart definition as defined in the chart.js documentation, \n    // in addition setting up the topic for each channel\n    var chartDef = {\n        type: 'scatter',\n        data: {\n          datasets: [\n            {\n              label: \"\",\n              fill: false,\n              pointStyle: 'rectRot',\n              pointRadius: 2,\n              lineTension: 0,\n              pointBackgroundColor: \"rgb(220, 0, 0)\",\n              borderColor: 'rgb(255, 0, 0)',\n              data: []  // data is written here later\n            },\n            {\n              label: \"\",\n              fill: false,\n              pointStyle: 'circle',\n              pointRadius: 2,\n              lineTension: 0,\n              pointBackgroundColor: \"rgb(0, 153, 255)\",\n              borderColor: 'rgb(0, 153, 255)',\n              data: []  // data is written here later\n            }        \n          ]\n        }, \n        options: {\n            animation: false,\n            fill: false,\n            tooltips: {\n                callbacks: {\n                    label: function (tooltipItem, data) {\n                        return Number(tooltipItem.xLabel).toFixed(2) +\"s, \" + Number(tooltipItem.yLabel).toFixed(3) + \"V\";\n                    }\n                }\n            },\n            legend: {\n                display: true,\n                labels: {\n                    fontColor: '#444'\n                }\n            },\n            layout: {\n                    padding: 10\n            },    \n            title: {\n                text: 'Coppia',\n                display: true,\n                fontColor: '#444'\n            }, \n            scales: {\n                xAxes: [{ \n                  scaleLabel: {\n                    display: true,\n                    fontColor: '#444',\n                    labelString: \"t [s]\"\n                  },\n                  ticks: {min: 0, max:0.5, tickStep: 0.1}\n                }],            \n                yAxes: [{ \n                  scaleLabel: {\n                    display: true,\n                    fontColor: '#444',\n                    labelString: \"Ampiezza [V]\"\n                  },\n                  ticks: {min: 0, max:3}\n                }]\n            }\n        }\n    };\n    \n    var myChart = null;\n    \n    function doChart(msg, scope) {\n        //var title = msg.payload.title;\n        var title = msg.payload.legend1;\n        \n        console.log(\"data 0:\");\n        console.log(msg.payload.data0);\n        if( msg.payload.data1.length > 0  ) {\n        console.log(\"data 1:\");\n        console.log(msg.payload.data1);\n        }\n        \n        if (!myChart) {\n            // chart does not exist so load the data and create it\n            var ctx = document.getElementById(chartID);\n            myChart = new Chart(ctx, chartDef); \n            \n            myChart.options.title.text = msg.payload.title;\n            \n            myChart.data.datasets[0].label = msg.payload.legend0;\n            myChart.data.datasets[1].label = msg.payload.legend1;\n        }\n\n\n        if( msg.payload.data0.length > 0  ) {\n            for(k=0; k<msg.payload.data0.length; k++) {\n              myChart.data.datasets[0].data.pop();\n            }\n           // myChart.update();\n            for(k=0; k<msg.payload.data0.length; k++) {\n              myChart.data.datasets[0].data.push( msg.payload.data0[k] );\n            }\n            myChart.update();\n        }        \n        \n        //myChart.data.datasets[1].data.push( dati1 );\n        if( msg.payload.data1.length > 0  ) {\n            for(k=0; k<msg.payload.data1.length; k++) {\n              myChart.data.datasets[1].data.pop();\n            }\n           // myChart.update();\n            for(k=0; k<msg.payload.data1.length; k++) {\n              myChart.data.datasets[1].data.push( msg.payload.data1[k] );\n            }\n            myChart.update();\n        }\n        \n        \n        // and update chart\n       // myChart.update();\n        \n    }\n    \n    (function(scope) {\n        // this code gets run when the a view is opened on the node in the browser\n        scope.$watch('msg', function(msg) {\n            if (msg) {\n                doChart(msg, scope);\n            }\n        });\n    })(scope);    \n    \n})();\n</script>\n",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 720,
        "y": 1540,
        "wires": [
            []
        ],
        "info": "decimals in tooltips:\nhttps://social.msdn.microsoft.com/Forums/en-US/64911138-1dad-4534-ad07-e789f4550d56/chartjs-plot-decimal-points"
    },
    {
        "id": "920309c211b4edb3",
        "type": "ui_template",
        "z": "24046517.06b45a",
        "group": "b03b962e.7c4d18",
        "name": "VelocitÃ ",
        "order": 7,
        "width": 8,
        "height": 5,
        "format": "<canvas id=\"SpeedChart\" width=\"300\" height=\"170\" style=\"border:1px solid #000000;margin: 2px;\"></canvas>\n\n<script>\n(function() {\n    var chartID = \"SpeedChart\";           // set this to the id you have specified in the canvas tag above\n\n    // setup the chart definition as defined in the chart.js documentation, \n    // in addition setting up the topic for each channel\n    var chartDef = {\n        type: 'scatter',\n        data: {\n          datasets: [\n            {\n              label: \"\",\n              fill: false,\n              pointStyle: 'rectRot',\n              pointRadius: 2,\n              lineTension: 0,\n              pointBackgroundColor: \"rgb(220, 0, 0)\",\n              borderColor: 'rgb(255, 0, 0)',\n              data: []  // data is written here later\n            },\n            {\n              label: \"\",\n              fill: false,\n              pointStyle: 'circle',\n              pointRadius: 2,\n              lineTension: 0,\n              pointBackgroundColor: \"rgb(0, 153, 255)\",\n              borderColor: 'rgb(0, 153, 255)',\n              data: []  // data is written here later\n            }        \n          ]\n        }, \n        options: {\n            animation: false,\n            fill: false,\n            tooltips: {\n                callbacks: {\n                    label: function (tooltipItem, data) {\n                        return Number(tooltipItem.xLabel).toFixed(2) +\"s, \" + Number(tooltipItem.yLabel).toFixed(3) + \"V\";\n                    }\n                }\n            },\n            legend: {\n                display: true,\n                labels: {\n                    fontColor: '#444'\n                }\n            },\n            layout: {\n                    padding: 10\n            },    \n            title: {\n                text: 'VelocitÃ ',\n                display: true,\n                fontColor: '#444'\n            }, \n            scales: {\n                xAxes: [{ \n                  scaleLabel: {\n                    display: true,\n                    fontColor: '#444',\n                    labelString: \"t [s]\"\n                  },\n                  ticks: {min: 0, max:0.5, tickStep: 0.1}\n                }],            \n                yAxes: [{ \n                  scaleLabel: {\n                    display: true,\n                    fontColor: '#444',\n                    labelString: \"Ampiezza [V]\"\n                  },\n                  ticks: {min: 0, max:3}\n                }]\n            }\n        }\n    };\n    \n    var myChart = null;\n    \n    function doChart(msg, scope) {\n        //var title = msg.payload.title;\n        var title = msg.payload.legend1;\n        \n        console.log(\"data 0:\");\n        console.log(msg.payload.data0);\n        if( msg.payload.data1.length > 0  ) {\n        console.log(\"data 1:\");\n        console.log(msg.payload.data1);\n        }\n        \n        if (!myChart) {\n            // chart does not exist so load the data and create it\n            var ctx = document.getElementById(chartID);\n            myChart = new Chart(ctx, chartDef); \n            \n            myChart.options.title.text = msg.payload.title;\n            \n            myChart.data.datasets[0].label = msg.payload.legend0;\n            myChart.data.datasets[1].label = msg.payload.legend1;\n        }\n\n\n        if( msg.payload.data0.length > 0  ) {\n            for(k=0; k<msg.payload.data0.length; k++) {\n              myChart.data.datasets[0].data.pop();\n            }\n           // myChart.update();\n            for(k=0; k<msg.payload.data0.length; k++) {\n              myChart.data.datasets[0].data.push( msg.payload.data0[k] );\n            }\n            myChart.update();\n        }        \n        \n        //myChart.data.datasets[1].data.push( dati1 );\n        if( msg.payload.data1.length > 0  ) {\n            for(k=0; k<msg.payload.data1.length; k++) {\n              myChart.data.datasets[1].data.pop();\n            }\n           // myChart.update();\n            for(k=0; k<msg.payload.data1.length; k++) {\n              myChart.data.datasets[1].data.push( msg.payload.data1[k] );\n            }\n            myChart.update();\n        }\n        \n        \n        // and update chart\n       // myChart.update();\n        \n    }\n    \n    (function(scope) {\n        // this code gets run when the a view is opened on the node in the browser\n        scope.$watch('msg', function(msg) {\n            if (msg) {\n                doChart(msg, scope);\n            }\n        });\n    })(scope);    \n    \n})();\n</script>\n",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 720,
        "y": 1600,
        "wires": [
            []
        ],
        "info": "decimals in tooltips:\nhttps://social.msdn.microsoft.com/Forums/en-US/64911138-1dad-4534-ad07-e789f4550d56/chartjs-plot-decimal-points"
    },
    {
        "id": "ba43cd7e821460b5",
        "type": "debug",
        "z": "24046517.06b45a",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 430,
        "y": 1480,
        "wires": []
    },
    {
        "id": "366aa1f575825ad4",
        "type": "mqtt in",
        "z": "1471bcf322cb6423",
        "name": "",
        "topic": "ESP32DevKit123/FFTBinTopic1",
        "qos": "0",
        "datatype": "buffer",
        "broker": "35a4e7d1.620608",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 150,
        "y": 400,
        "wires": [
            [
                "af89c7689ee2c588"
            ]
        ]
    },
    {
        "id": "c138a4b8c8b20872",
        "type": "debug",
        "z": "1471bcf322cb6423",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 250,
        "y": 100,
        "wires": []
    },
    {
        "id": "734b297547800c70",
        "type": "file",
        "z": "1471bcf322cb6423",
        "d": true,
        "name": "",
        "filename": "C:\\Users\\luca\\Documents\\PlatformIO\\Projects\\ESP32_Devkit_ADS1256_FFT_AsyncMQTT_binary_01\\ricevuto.txt",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1230,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "af89c7689ee2c588",
        "type": "join",
        "z": "1471bcf322cb6423",
        "name": "",
        "mode": "custom",
        "build": "buffer",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 370,
        "y": 400,
        "wires": [
            [
                "5b043a62a8189c71",
                "d250054b5d0d87c6"
            ]
        ]
    },
    {
        "id": "5b043a62a8189c71",
        "type": "function",
        "z": "1471bcf322cb6423",
        "name": "ToFloatArray1",
        "func": "// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\n// https://stackoverflow.com/questions/8609289/convert-a-binary-nodejs-buffer-to-javascript-arraybuffer/31394257#31394257\n\n// convert the NodeJS binary buffer into a Javascript ArrayBuffer\nlet b = msg.payload;\nlet myBuffer = b.buffer.slice(b.byteOffset, b.byteOffset + b.byteLength);\n\n//// convert the NodeJS binary buffer into a Javascript ArrayBuffer\n//myBuffer = msg.payload.buffer;\n\n// put a DataView over the ArrayBuffer to make it easy to access data value\nvar dv = new DataView(myBuffer);\n\n// how many elements will be converted \nlet bytes_per_element = Float32Array.BYTES_PER_ELEMENT;\nlet byte_buffer_size = myBuffer.byteLength;\nlet number_of_element = byte_buffer_size / bytes_per_element;\nlet half_number_of_element = number_of_element / 2;\n\n// create the typed array to store the converted values\nvar floatArray = new Float32Array(number_of_element);\n\n// just for debug...\n/*\nmsg.bytes_per_element = bytes_per_element;\nmsg.number_of_element = number_of_element;\nmsg.byte_length = byte_buffer_size;\n*/\n\n// iterate over the dataview and get the values\nvar j, k;\nfor (k = 0, j = 0; j < byte_buffer_size; k++, j = j + bytes_per_element) {\n  // all the values in the buffer are little-endian, set the optional littleEndian parameter to \"true\"\n  floatArray[k] = dv.getFloat32(j, true);\n}\n\n// we need to swap array halves? check if first element of the second half is lesser than 0\nif (floatArray[half_number_of_element] < 0.0) {\n  // rotate array elements by half of array size\n  // see https://stackoverflow.com/questions/1985260/rotate-the-elements-in-an-array-in-javascript/33451102#33451102\n  //floatArray.push.apply(floatArray, floatArray.splice(0, half_number_of_element));\n\n  const b2 = floatArray.slice(half_number_of_element, number_of_element);\n  b2.push.apply(b2, floatArray.slice(0, half_number_of_element));\n  // remove sign from array's first element\n  b2[0] = Math.abs(floatArray[0]);\n  // this is the new payload\n  msg.payload.ch1 = b2;\n} else {\n  // remove sign from array's first element\n  floatArray[0] = Math.abs(floatArray[0]);\n  // this is the new payload\n  msg.payload.ch1 = floatArray;\n}\n\n//floatArray = [];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 400,
        "wires": [
            [
                "5a163d9094f9eceb",
                "81edee3e34e23663"
            ]
        ],
        "info": "// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/"
    },
    {
        "id": "449276a4ce8cf14b",
        "type": "comment",
        "z": "1471bcf322cb6423",
        "name": "number of blocks",
        "info": "Impostare manualmente la proprietà:\nAfter a number of message parts...\n\ndividendo la dimensione del messaggio per 4096",
        "x": 360,
        "y": 440,
        "wires": []
    },
    {
        "id": "5a163d9094f9eceb",
        "type": "function",
        "z": "1471bcf322cb6423",
        "name": "Create plot information",
        "func": "// get FFT parameters\nvar FSAMPLE = flow.get(\"FSAMPLE\") || 7500; //3750;  // Samples per second\nvar FFT_SIZE = flow.get(\"FFT_SIZE\") || 1<<12;\n\nvar Ts = 1.0/FSAMPLE;\nvar df = 1.0 / (Ts * FFT_SIZE);\n\n// this is where you define the legend for the datasets\nvar title = \"Spettro delle ampiezze\";\nvar legend0 = \"Canale 0\";\nvar legend1 = \"Canale 1\";\n\n// variables to be used\nvar i;\nvar m;\n\n// retrieve datasets from node context\nvar data0 = context.get(\"dataset0\") || [];\nvar data1 = context.get(\"dataset1\") || [];\nvar equalizer = flow.get(\"EQUALIZER\") || [];\n\nvar eq_def = (equalizer.length > 0);\n\nif( msg.payload.hasOwnProperty(\"ch0\") ) {\n    data0 =[];\n    \n    for(i=0; i < msg.payload.ch0.length; i++) {\n       m = (eq_def) ? equalizer[i] : 1.0;\n       data0.push( {\"x\": i*df, \"y\": m * msg.payload.ch0[i] } );\n    }\n    \n    // store the new dataset into node context\n    context.set(\"dataset0\", data0);\n}\n\nif( msg.payload.hasOwnProperty(\"ch1\") ) {\n    data1 =[];\n    \n    for(i=0; i < msg.payload.ch1.length; i++) {\n      m = (eq_def) ? equalizer[i] : 1.0;\n      data1.push( {\"x\": i*df, \"y\": m * msg.payload.ch1[i] } );\n    }\n    \n    // store the new dataset into node context\n    context.set(\"dataset1\", data1);\n}\n\n// Now we build msg.payload\nmsg.payload = { \"title\"   : title,\n                \"legend0\" : legend0,\n                \"data0\"   : data0,\n                \"legend1\" : legend1,\n                \"data1\"   : data1,\n                \"df\"      : df\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 460,
        "wires": [
            [
                "c08ce136b3aa28b6",
                "90454b6f7d090b0c",
                "80474661f0055e01"
            ]
        ]
    },
    {
        "id": "1df3fca970c91e6e",
        "type": "inject",
        "z": "1471bcf322cb6423",
        "name": "Description",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.2",
        "topic": "",
        "payload": " ",
        "payloadType": "str",
        "x": 150,
        "y": 840,
        "wires": [
            [
                "8a2434fd86744fc6"
            ]
        ]
    },
    {
        "id": "df1d430e198bb19a",
        "type": "function",
        "z": "1471bcf322cb6423",
        "d": true,
        "name": "ToUInt32Array",
        "func": "// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\n\n// convert the NodeJS binary buffer into a Javascript ArrayBuffer\nmyBuffer = msg.payload.buffer;\n// put a DataView over the ArrayBuffer to make it easy to access data value\nvar dv = new DataView(myBuffer);\n\n// how many elements will be converted \nlet bytes_per_element = Uint32Array.BYTES_PER_ELEMENT;\nlet byte_buffer_size = myBuffer.byteLength;\nlet number_of_element = byte_buffer_size/bytes_per_element;\n\n// create the typed array to store the converted values\nvar UIntArray = new Uint32Array(number_of_element);\n\n// just for debug...\n/*\nmsg.bytes_per_element = bytes_per_element;\nmsg.number_of_element = number_of_element;\nmsg.byte_length = byte_buffer_size;\n*/\n\n// iterate over the dataview and get the values\nfor (k=0, j=0; j<byte_buffer_size; k++, j=j+bytes_per_element) {\n  // all the values in the buffer are little-endian, set the optional littleEndian parameter to \"true\"\n  UIntArray[k] = dv.getUint32(j, true); \n}\n\n// this is the new payload\nmsg.payload = UIntArray;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 720,
        "y": 180,
        "wires": [
            [
                "734b297547800c70"
            ]
        ]
    },
    {
        "id": "067bdccadc670aed",
        "type": "mqtt out",
        "z": "1471bcf322cb6423",
        "name": "",
        "topic": "ESP32DevKit123/trigger",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "35a4e7d1.620608",
        "x": 530,
        "y": 920,
        "wires": []
    },
    {
        "id": "c08ce136b3aa28b6",
        "type": "file",
        "z": "1471bcf322cb6423",
        "d": true,
        "name": "",
        "filename": "C:\\Users\\luca\\Documents\\PlatformIO\\Projects\\ESP32_Devkit_ADS1256_FFT_AsyncMQTT_binary_01\\dati_chart.txt",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 790,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "7bb5ec7994eeb16f",
        "type": "mqtt in",
        "z": "1471bcf322cb6423",
        "name": "",
        "topic": "ESP32DevKit123/FFTBinTopic0",
        "qos": "0",
        "datatype": "buffer",
        "broker": "35a4e7d1.620608",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 150,
        "y": 520,
        "wires": [
            [
                "bd0fb9068f9a8c9e"
            ]
        ]
    },
    {
        "id": "bd0fb9068f9a8c9e",
        "type": "join",
        "z": "1471bcf322cb6423",
        "name": "",
        "mode": "custom",
        "build": "buffer",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 370,
        "y": 520,
        "wires": [
            [
                "1d7c5560ffd71ad9",
                "0214887e1b16ab8e"
            ]
        ]
    },
    {
        "id": "62d4f37bcb1cb991",
        "type": "comment",
        "z": "1471bcf322cb6423",
        "name": "number of blocks",
        "info": "Impostare manualmente la proprietà:\nAfter a number of message parts...\n\ndividendo la dimensione del messaggio per 4096",
        "x": 360,
        "y": 560,
        "wires": []
    },
    {
        "id": "1d7c5560ffd71ad9",
        "type": "function",
        "z": "1471bcf322cb6423",
        "name": "ToFloatArray0",
        "func": "// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\n// https://stackoverflow.com/questions/8609289/convert-a-binary-nodejs-buffer-to-javascript-arraybuffer/31394257#31394257\n\n// convert the NodeJS binary buffer into a Javascript ArrayBuffer\nlet b = msg.payload;\nlet myBuffer = b.buffer.slice(b.byteOffset, b.byteOffset + b.byteLength);\n\n//// convert the NodeJS binary buffer into a Javascript ArrayBuffer\n//myBuffer = msg.payload.buffer;\n\n// put a DataView over the ArrayBuffer to make it easy to access data value\nvar dv = new DataView(myBuffer);\n\n// how many elements will be converted \nlet bytes_per_element = Float32Array.BYTES_PER_ELEMENT;\nlet byte_buffer_size = myBuffer.byteLength;\nlet number_of_element = byte_buffer_size / bytes_per_element;\nlet half_number_of_element = number_of_element / 2;\n\n// create the typed array to store the converted values\nvar floatArray = new Float32Array(number_of_element);\n\n// just for debug...\n/*\nmsg.bytes_per_element = bytes_per_element;\nmsg.number_of_element = number_of_element;\nmsg.byte_length = byte_buffer_size;\n*/\n\n// iterate over the dataview and get the values\nvar j, k;\nfor (k = 0, j = 0; j < byte_buffer_size; k++, j = j + bytes_per_element) {\n  // all the values in the buffer are little-endian, set the optional littleEndian parameter to \"true\"\n  floatArray[k] = dv.getFloat32(j, true);\n}\n\n// we need to swap array halves? check if first element of the second half is lesser than 0\nif (floatArray[half_number_of_element] < 0.0) {\n  // rotate array elements by half of array size\n  // see https://stackoverflow.com/questions/1985260/rotate-the-elements-in-an-array-in-javascript/33451102#33451102\n  //floatArray.push.apply(floatArray, floatArray.splice(0, half_number_of_element));\n\n  const b2 = floatArray.slice(half_number_of_element, number_of_element);\n  b2.push.apply(b2, floatArray.slice(0, half_number_of_element));\n  // remove sign from array's first element\n  b2[0] = Math.abs(floatArray[0]);\n  // this is the new payload\n  msg.payload.ch0 = b2;\n} else {\n  // remove sign from array's first element\n  floatArray[0] = Math.abs(floatArray[0]);\n  // this is the new payload\n  msg.payload.ch0 = floatArray;\n}\n\n//floatArray = [];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 520,
        "wires": [
            [
                "5a163d9094f9eceb"
            ]
        ]
    },
    {
        "id": "781ddc55c0641c15",
        "type": "status",
        "z": "1471bcf322cb6423",
        "name": "",
        "scope": [
            "366aa1f575825ad4"
        ],
        "x": 80,
        "y": 60,
        "wires": [
            [
                "370ee535d7084c33",
                "c138a4b8c8b20872"
            ]
        ]
    },
    {
        "id": "b4efcf60619655b4",
        "type": "function",
        "z": "1471bcf322cb6423",
        "name": "Get_mqtt_status",
        "func": "var status = flow.get(\"mqtt_status\") || {};\n\nif (status.text==\"node-red:common.status.connected\")\n{\n  msg.payload = \"Connected\";\n}\nelse if (status.text==\"node-red:common.status.connecting\")\n{\n  msg.payload = \"Connecting...\";\n}\nelse if (status.text==\"node-red:common.status.disconnected\") {\n  msg.payload = \"Disconnected\";    \n}\nelse {\n    msg.payload = \"a\";\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 60,
        "wires": [
            [
                "e8826d846daf3644",
                "29f5d7e65cbe941a"
            ]
        ]
    },
    {
        "id": "370ee535d7084c33",
        "type": "function",
        "z": "1471bcf322cb6423",
        "name": "Store_mqtt_status",
        "func": "var mqtt_status=msg.status;\nflow.set(\"mqtt_status\",mqtt_status);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "e8826d846daf3644",
        "type": "debug",
        "z": "1471bcf322cb6423",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 890,
        "y": 100,
        "wires": []
    },
    {
        "id": "364cee0c1af6dea4",
        "type": "inject",
        "z": "1471bcf322cb6423",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "2",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 510,
        "y": 60,
        "wires": [
            [
                "b4efcf60619655b4"
            ]
        ]
    },
    {
        "id": "1531ed231167c33b",
        "type": "mqtt in",
        "z": "1471bcf322cb6423",
        "name": "",
        "topic": "ESP32DevKit123/RTD1BinTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "35a4e7d1.620608",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 170,
        "y": 1240,
        "wires": [
            [
                "4ef6d7277596c6d3"
            ]
        ]
    },
    {
        "id": "fcd47c7a19f4b963",
        "type": "function",
        "z": "1471bcf322cb6423",
        "name": "RTD_float",
        "func": "// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\n\n//var fbuffer = new ArrayBuffer(4);\n//new DataView(fbuffer).setFloat32(0, 1.0, true /* littleEndian */);\n\n//fbuffer = msg.payload.buffer;\n//const view = new DataView(fbuffer);\n/*\nvar ab = new ArrayBuffer(msg.payload.length);\n//const view = new Float32Array(ab);\n\n    for (let i = 0; i < msg.payload.length; i++) {\n        ab[i] = msg.payload[i];\n    }\n\nvar dv = new DataView(ab);\n//msg.payload.rtd1 = new Float32Array(msg.payload)[0];\nmsg.payload.rtd1 = dv.getFloat32(0, true);\n//msg.payload.rtd1 = msg.payload.byteLength;\n*/\n\nlet b = msg.payload;\nlet f32 = new Float32Array(b.buffer, 0, b.byteLength / Float32Array.BYTES_PER_ELEMENT);\nmsg.payload = f32[0];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 470,
        "y": 1120,
        "wires": [
            [
                "827a707b1da54b05"
            ]
        ]
    },
    {
        "id": "827a707b1da54b05",
        "type": "debug",
        "z": "1471bcf322cb6423",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 1120,
        "wires": []
    },
    {
        "id": "60c3eadb5d863414",
        "type": "debug",
        "z": "1471bcf322cb6423",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 750,
        "y": 260,
        "wires": []
    },
    {
        "id": "17100423f092c45f",
        "type": "mqtt in",
        "z": "1471bcf322cb6423",
        "name": "",
        "topic": "ESP32DevKit123/RTD2BinTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "35a4e7d1.620608",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 170,
        "y": 1360,
        "wires": [
            [
                "0a135c093f454bf6"
            ]
        ]
    },
    {
        "id": "c5d99cc1ddf06a2e",
        "type": "mqtt in",
        "z": "1471bcf322cb6423",
        "name": "",
        "topic": "ESP32DevKit123/CountAdcTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "35a4e7d1.620608",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 170,
        "y": 1480,
        "wires": [
            [
                "b98609121ba95407"
            ]
        ]
    },
    {
        "id": "81edee3e34e23663",
        "type": "debug",
        "z": "1471bcf322cb6423",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 400,
        "wires": []
    },
    {
        "id": "5e48f079eb61868e",
        "type": "inject",
        "z": "1471bcf322cb6423",
        "name": "Create parameters",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 260,
        "wires": [
            [
                "24c44c82a9e6d2a8"
            ]
        ]
    },
    {
        "id": "24c44c82a9e6d2a8",
        "type": "function",
        "z": "1471bcf322cb6423",
        "name": "Set parameters",
        "func": "var FSAMPLE = 7500; //3750;  // Samples per second\nvar FFT_SIZE = 1<<12;        // FFT size (must be a power of two)\nvar MCP_SAMPLE_PERIOD = 10e-3;\n\nflow.set(\"FSAMPLE\", FSAMPLE);\nflow.set(\"FFT_SIZE\", FFT_SIZE);\nflow.set(\"MCP_SAMPLE_PERIOD\", MCP_SAMPLE_PERIOD);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 260,
        "wires": [
            [
                "b3a46a955dc4780a"
            ]
        ]
    },
    {
        "id": "b3a46a955dc4780a",
        "type": "function",
        "z": "1471bcf322cb6423",
        "name": "ADC sinc equalizer",
        "func": "// precompute the overall frequency response for the ADS1255/6\n// see: ADS1256.pdf, page 18 equation 2\nvar FSAMPLE = flow.get(\"FSAMPLE\") || 7500;\nvar FFT_SIZE = flow.get(\"FFT_SIZE\")|| 2<<11;\nvar len = FFT_SIZE / 2;\nvar Num_Ave = 4;\nvar Ts = 1.0/FSAMPLE;        // sample period\nvar df = 1.0 / (Ts * FFT_SIZE);  // FFT frequency resolution\nvar F_CLKIN = 7.68e6;\nvar I_F_CLKIN = 1 / F_CLKIN;\nvar pi = Math.PI;\nvar i;\nvar R_lp = 1e2;\nvar C_lp = 180e-9;\nvar tau_lp = R_lp * C_lp;\nvar f_lp = (1/tau_lp)/(2*pi);\n\n// create the typed array to store the converted values\nvar equalizer = new Float32Array(len);\n\nfor(i=0; i<len; i++) {\n    var f = i * df;\n    var f_n = f * I_F_CLKIN;\n    var n1 = Math.sin(256*pi*f_n);\n    var d1 = 64 * Math.sin(4 * pi * f_n);\n    var n2 = Math.sin( 256 * pi * Num_Ave * f_n);\n    var d2 = Num_Ave * Math.sin( 256 * pi * f_n);\n    \n    var H_sinc = Math.abs( n1 / d1  )**5;\n    var H_averager = Math.abs(n2/d2);\n    var p = H_sinc * H_averager / Math.sqrt(1 + (f/f_lp)**2 );\n    // se p == 0, assegna 1 di default\n    p = 1.0;\n    equalizer[i] = (p > 0)  ? 1.0 / p : 1.0;\n}\n\nflow.set(\"EQUALIZER\", equalizer);\nmsg.df = df;\nmsg.payload=equalizer;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 530,
        "y": 260,
        "wires": [
            [
                "60c3eadb5d863414"
            ]
        ]
    },
    {
        "id": "c926cdbea08aa930",
        "type": "mqtt in",
        "z": "1471bcf322cb6423",
        "name": "",
        "topic": "ESP32DevKit123/RTD1FaultTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "35a4e7d1.620608",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 180,
        "y": 1300,
        "wires": [
            [
                "c05911f82c9f9dd1"
            ]
        ]
    },
    {
        "id": "c05911f82c9f9dd1",
        "type": "ui_text",
        "z": "1471bcf322cb6423",
        "group": "5f88817443cb3d4b",
        "order": 22,
        "width": 7,
        "height": 1,
        "name": "",
        "label": "RTD1 status:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 710,
        "y": 1300,
        "wires": []
    },
    {
        "id": "0c2d57071974930f",
        "type": "mqtt in",
        "z": "1471bcf322cb6423",
        "name": "",
        "topic": "ESP32DevKit123/RTD2FaultTopic",
        "qos": "0",
        "datatype": "utf8",
        "broker": "35a4e7d1.620608",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 180,
        "y": 1420,
        "wires": [
            [
                "f2eb6305e7e164b0"
            ]
        ]
    },
    {
        "id": "f2eb6305e7e164b0",
        "type": "ui_text",
        "z": "1471bcf322cb6423",
        "group": "5f88817443cb3d4b",
        "order": 23,
        "width": 7,
        "height": 1,
        "name": "",
        "label": "RTD2 status:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 710,
        "y": 1420,
        "wires": []
    },
    {
        "id": "0a135c093f454bf6",
        "type": "ui_gauge",
        "z": "1471bcf322cb6423",
        "name": "rtd2",
        "group": "5f88817443cb3d4b",
        "order": 4,
        "width": 2,
        "height": 2,
        "gtype": "gage",
        "title": "RTD2",
        "label": "°C",
        "format": "{{value | number:2}}",
        "min": 0,
        "max": "50",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 470,
        "y": 1360,
        "wires": []
    },
    {
        "id": "4ef6d7277596c6d3",
        "type": "ui_gauge",
        "z": "1471bcf322cb6423",
        "name": "rtd1",
        "group": "5f88817443cb3d4b",
        "order": 1,
        "width": 2,
        "height": 2,
        "gtype": "gage",
        "title": "RTD1",
        "label": "°C",
        "format": "{{value | number:2}}",
        "min": 0,
        "max": "50",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 470,
        "y": 1240,
        "wires": []
    },
    {
        "id": "90454b6f7d090b0c",
        "type": "ui_template",
        "z": "1471bcf322cb6423",
        "group": "5f88817443cb3d4b",
        "name": "Spettro ADS1256",
        "order": 2,
        "width": 14,
        "height": 8,
        "format": "<canvas id=\"scatterChart\" width=\"750\" height=\"400\" style=\"border:1px solid #000000;margin: 2px;\"></canvas>\n\n<script>\n(function() {\n    var chartID = \"scatterChart\";           // set this to the id you have specified in the canvas tag above\n\n    // setup the chart definition as defined in the chart.js documentation, \n    // in addition setting up the topic for each channel\n    var chartDef = {\n        type: 'scatter',\n        data: {\n          datasets: [\n            {\n              label: \"\",\n              fill: false,\n              pointStyle: 'dot',  // pointStyle: 'rectRot'\n              pointRadius: 1,\n              lineTension: 0,\n              pointBackgroundColor: 'rgba(220, 0, 0, 0.6)',\n              borderColor: 'rgba(220, 0, 0, 0.6)',\n              data: []  // data is written here later\n            },\n            {\n              label: \"\",\n              fill: false,\n              pointStyle: 'dot',\n              pointRadius: 2,\n              lineTension: 0,\n              pointBackgroundColor: 'rgba(0, 220, 0, 0.8)', // \"rgb(0, 220, 0)\",\n              borderColor: 'rgba(0, 220, 0, 0.8)',\n              data: []  // data is written here later\n            }        \n          ]\n        }, \n        options: {\n            animation: false,\n            fill: false,\n            tooltips: {\n                callbacks: {\n                    label: function (tooltipItem, data) {\n                        return Number(tooltipItem.xLabel).toFixed(2) +\"Hz, \" + Number(tooltipItem.yLabel).toFixed(3) + \"V\";\n                    }\n                }\n            },\n            legend: {\n                display: true,\n                labels: {\n                    fontColor: '#444'\n                }\n            },\n            layout: {\n                    padding: 10\n            },    \n            title: {\n                text: 'Accelerazioni',\n                display: true,\n                fontColor: '#444'\n            }, \n            scales: {\n                xAxes: [{ \n                  scaleLabel: {\n                    display: true,\n                    fontColor: '#444',\n                    labelString: \"Frequenza [Hz]\"\n                  },\n                  ticks: {min: 0, max:4000, tickStep: 250}\n                }],            \n                yAxes: [{ \n                  scaleLabel: {\n                    display: true,\n                    fontColor: '#444',\n                    labelString: \"Ampiezza [V]\"\n                  },\n                  ticks: {min: 0, max:0.5}\n                }]\n            }\n        }\n    };\n    \n    var myChart = null;\n    \n    function doChart(msg, scope) {\n        //var title = msg.payload.title;\n        var title = msg.payload.legend1;\n        \n        console.log(\"data 0:\");\n        console.log(msg.payload.data0);\n        if( msg.payload.data1.length > 0  ) {\n        console.log(\"data 1:\");\n        console.log(msg.payload.data1);\n        }\n        \n        if (!myChart) {\n            // chart does not exist so load the data and create it\n            var ctx = document.getElementById(chartID);\n            myChart = new Chart(ctx, chartDef); \n            \n            myChart.options.title.text = msg.payload.title;\n            \n            myChart.data.datasets[0].label = msg.payload.legend0;\n            myChart.data.datasets[1].label = msg.payload.legend1;\n        }\n\n\n        if( msg.payload.data0.length > 0  ) {\n            for(k=0; k<msg.payload.data0.length; k++) {\n              myChart.data.datasets[0].data.pop();\n            }\n           // myChart.update();\n            for(k=0; k<msg.payload.data0.length; k++) {\n              myChart.data.datasets[0].data.push( msg.payload.data0[k] );\n            }\n            myChart.update();\n        }        \n        \n        //myChart.data.datasets[1].data.push( dati1 );\n        if( msg.payload.data1.length > 0  ) {\n            for(k=0; k<msg.payload.data1.length; k++) {\n              myChart.data.datasets[1].data.pop();\n            }\n           // myChart.update();\n            for(k=0; k<msg.payload.data1.length; k++) {\n              myChart.data.datasets[1].data.push( msg.payload.data1[k] );\n            }\n            myChart.update();\n        }\n        \n        \n        // and update chart\n       // myChart.update();\n        \n    }\n    \n    (function(scope) {\n        // this code gets run when the a view is opened on the node in the browser\n        scope.$watch('msg', function(msg) {\n            if (msg) {\n                doChart(msg, scope);\n            }\n        });\n    })(scope);    \n    \n})();\n</script>\n",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 1070,
        "y": 460,
        "wires": [
            []
        ],
        "info": "decimals in tooltips:\nhttps://social.msdn.microsoft.com/Forums/en-US/64911138-1dad-4534-ad07-e789f4550d56/chartjs-plot-decimal-points"
    },
    {
        "id": "8f0b51bd7a9a841f",
        "type": "ui_button",
        "z": "1471bcf322cb6423",
        "name": "",
        "group": "5f88817443cb3d4b",
        "order": 14,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Single shot",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "1",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 150,
        "y": 920,
        "wires": [
            [
                "067bdccadc670aed"
            ]
        ]
    },
    {
        "id": "551f3f436a9a1d06",
        "type": "ui_button",
        "z": "1471bcf322cb6423",
        "name": "",
        "group": "5f88817443cb3d4b",
        "order": 16,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Free Run",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "2",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 160,
        "y": 960,
        "wires": [
            [
                "067bdccadc670aed"
            ]
        ]
    },
    {
        "id": "57597ba4b7773436",
        "type": "ui_button",
        "z": "1471bcf322cb6423",
        "name": "",
        "group": "5f88817443cb3d4b",
        "order": 18,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Stop",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "0",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 170,
        "y": 1000,
        "wires": [
            [
                "067bdccadc670aed"
            ]
        ]
    },
    {
        "id": "8a2434fd86744fc6",
        "type": "ui_text",
        "z": "1471bcf322cb6423",
        "group": "5f88817443cb3d4b",
        "order": 25,
        "width": 24,
        "height": 1,
        "name": "demo 1 description",
        "label": "ISIS Bassa Friulana - Dipartimento di Elettronica e Telecomunicazioni",
        "format": "",
        "layout": "row-center",
        "className": "",
        "x": 510,
        "y": 840,
        "wires": []
    },
    {
        "id": "29f5d7e65cbe941a",
        "type": "ui_text",
        "z": "1471bcf322cb6423",
        "group": "5f88817443cb3d4b",
        "order": 21,
        "width": 8,
        "height": 1,
        "name": "MQTT status",
        "label": "MQTT status:",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 910,
        "y": 60,
        "wires": []
    },
    {
        "id": "0d856c2d31631a1f",
        "type": "mqtt in",
        "z": "1471bcf322cb6423",
        "name": "",
        "topic": "ESP32DevKit123/TorqueSpeedTopic",
        "qos": "0",
        "datatype": "buffer",
        "broker": "35a4e7d1.620608",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 180,
        "y": 1580,
        "wires": [
            [
                "b1492415ffcca6f7"
            ]
        ]
    },
    {
        "id": "b1492415ffcca6f7",
        "type": "function",
        "z": "1471bcf322cb6423",
        "name": "ToMCPPoints",
        "func": "// get MCP3204 parameters\nvar Ts = flow.get(\"MCP_SAMPLE_PERIOD\") || 10e-3;\n\n// this is where you define the legend for the datasets\nvar title1 = \"Coppie meccaniche\";\nvar title2 = \"Velocità\";\nvar legend0 = \"Coppia 1\";\nvar legend1 = \"Coppia 2\";\nvar legend2 = \"Velocità 1\";\nvar legend3 = \"Velocità 2\";\n\n// variables to be used\nvar i;\nvar data0 = [];\nvar data1 = [];\nvar data2 = [];\nvar data3 = [];\n\n// https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/\n// https://stackoverflow.com/questions/8609289/convert-a-binary-nodejs-buffer-to-javascript-arraybuffer/31394257#31394257\n\n// convert the NodeJS binary buffer into a Javascript ArrayBuffer\nlet b = msg.payload;\nlet mcpBuffer = b.buffer.slice(b.byteOffset, b.byteOffset + b.byteLength);\n\n// put a DataView over the ArrayBuffer to make it easy to access data value\nvar dv = new DataView(mcpBuffer);\n\n// how many elements will be converted \nlet bytes_per_element1 = Float32Array.BYTES_PER_ELEMENT;\nvar byte_buffer_size1 =  mcpBuffer.byteLength;\nvar number_of_element1 = byte_buffer_size1/bytes_per_element1;\n\n// samples per channel\nvar samples_per_channel = number_of_element1/4;\n\n// create the typed array to store the converted values\nvar floatArray1 = new Float32Array(number_of_element1);\n\n// just for debug...\n/*\nmsg.bytes_per_element1 = bytes_per_element1;\nmsg.number_of_element1 = number_of_element1;\nmsg.byte_buffer_size1 = mcpBuffer.byteLength;\n*/\n// iterate over the dataview and get the values\nfor (k=0, j=0; j<byte_buffer_size1; k++, j=j+bytes_per_element1) {\n  // all the values in the buffer are little-endian, set the optional littleEndian parameter to \"true\"\n  floatArray1[k] = dv.getFloat32(j, true); \n}\n\n// split the floatArray into four datasets\ndata0 = floatArray1.slice(0, samples_per_channel);\ndata1 = floatArray1.slice(samples_per_channel, 2*samples_per_channel);\ndata2 = floatArray1.slice(2*samples_per_channel, 3*samples_per_channel);\ndata3 = floatArray1.slice(3*samples_per_channel, 4*samples_per_channel);\n\n//console.log(data0);\n//console.log(data1);\n\nvar points0 = [];\nvar points1 = [];\nvar points2 = [];\nvar points3 = [];\n\nfor(i=0; i < samples_per_channel; i++) {\n   points0.push( {\"x\": i*Ts, \"y\": data0[i] } );\n}\n\nfor(i=0; i < samples_per_channel; i++) {\n   points1.push( {\"x\": i*Ts, \"y\": data1[i] } );\n} \n\nfor(i=0; i < samples_per_channel; i++) {\n   points2.push( {\"x\": i*Ts, \"y\": data2[i] } );\n}\n\nfor(i=0; i < samples_per_channel; i++) {\n   points3.push( {\"x\": i*Ts, \"y\": data3[i] } );\n}\n\n//console.log(points0);\n//console.log(points1);\n\n// Now we build msg1.payload\nvar msg1 = { payload: {} };\nmsg1.payload = { \"title\"   : title1,\n                \"legend0\" : legend0,\n                \"data0\"   : points0,\n                \"legend1\" : legend1,\n                \"data1\"   : points1,\n                \"Ts\"      : Ts\n};\n\n// Now we build msg2.payload\nvar msg2 = { payload: {} };\nmsg2.payload = { \"title\"   : title2,\n                \"legend0\" : legend2,\n                \"data0\"   : points2,\n                \"legend1\" : legend3,\n                \"data1\"   : points3,\n                \"Ts\"      : Ts\n};\n\nreturn [msg1, msg2];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 1580,
        "wires": [
            [
                "23f1d00e6580bfa5"
            ],
            [
                "7c4fd6f05725eb35"
            ]
        ],
        "info": "https://stackoverflow.com/questions/8609289/convert-a-binary-nodejs-buffer-to-javascript-arraybuffer\n...\nThe slice and offset stuff is required because small Buffers (less than 4 kB by default, half the [pool size](https://nodejs.org/dist/latest-v12.x/docs/api/buffer.html#buffer_class_property_buffer_poolsize)) can be views on a shared ArrayBuffer. Without slicing, you can end up with an ArrayBuffer containing data from another Buffer. See explanation [in the docs](https://nodejs.org/dist/latest-v12.x/docs/api/buffer.html#buffer_buf_byteoffset)."
    },
    {
        "id": "80474661f0055e01",
        "type": "debug",
        "z": "1471bcf322cb6423",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1070,
        "y": 580,
        "wires": []
    },
    {
        "id": "23f1d00e6580bfa5",
        "type": "ui_template",
        "z": "1471bcf322cb6423",
        "group": "5f88817443cb3d4b",
        "name": "Coppie",
        "order": 3,
        "width": 8,
        "height": 5,
        "format": "<canvas id=\"TorqueChart\" width=\"300\" height=\"170\" style=\"border:1px solid #000000;margin: 2px;\"></canvas>\n\n<script>\n(function() {\n    var chartID = \"TorqueChart\";           // set this to the id you have specified in the canvas tag above\n\n    // setup the chart definition as defined in the chart.js documentation, \n    // in addition setting up the topic for each channel\n    var chartDef = {\n        type: 'scatter',\n        data: {\n          datasets: [\n            {\n              label: \"\",\n              fill: false,\n              pointStyle: 'rectRot',\n              pointRadius: 2,\n              lineTension: 0,\n              pointBackgroundColor: \"rgb(220, 0, 0)\",\n              borderColor: 'rgb(255, 0, 0)',\n              data: []  // data is written here later\n            },\n            {\n              label: \"\",\n              fill: false,\n              pointStyle: 'circle',\n              pointRadius: 2,\n              lineTension: 0,\n              pointBackgroundColor: \"rgb(0, 153, 255)\",\n              borderColor: 'rgb(0, 153, 255)',\n              data: []  // data is written here later\n            }        \n          ]\n        }, \n        options: {\n            animation: false,\n            fill: false,\n            tooltips: {\n                callbacks: {\n                    label: function (tooltipItem, data) {\n                        return Number(tooltipItem.xLabel).toFixed(2) +\"s, \" + Number(tooltipItem.yLabel).toFixed(3) + \"V\";\n                    }\n                }\n            },\n            legend: {\n                display: true,\n                labels: {\n                    fontColor: '#444'\n                }\n            },\n            layout: {\n                    padding: 10\n            },    \n            title: {\n                text: 'Coppia',\n                display: true,\n                fontColor: '#444'\n            }, \n            scales: {\n                xAxes: [{ \n                  scaleLabel: {\n                    display: true,\n                    fontColor: '#444',\n                    labelString: \"t [s]\"\n                  },\n                  ticks: {min: 0, max:0.5, tickStep: 0.1}\n                }],            \n                yAxes: [{ \n                  scaleLabel: {\n                    display: true,\n                    fontColor: '#444',\n                    labelString: \"Ampiezza [V]\"\n                  },\n                  ticks: {min: 0, max:3}\n                }]\n            }\n        }\n    };\n    \n    var myChart = null;\n    \n    function doChart(msg, scope) {\n        //var title = msg.payload.title;\n        var title = msg.payload.legend1;\n        \n        console.log(\"data 0:\");\n        console.log(msg.payload.data0);\n        if( msg.payload.data1.length > 0  ) {\n        console.log(\"data 1:\");\n        console.log(msg.payload.data1);\n        }\n        \n        if (!myChart) {\n            // chart does not exist so load the data and create it\n            var ctx = document.getElementById(chartID);\n            myChart = new Chart(ctx, chartDef); \n            \n            myChart.options.title.text = msg.payload.title;\n            \n            myChart.data.datasets[0].label = msg.payload.legend0;\n            myChart.data.datasets[1].label = msg.payload.legend1;\n        }\n\n\n        if( msg.payload.data0.length > 0  ) {\n            for(k=0; k<msg.payload.data0.length; k++) {\n              myChart.data.datasets[0].data.pop();\n            }\n           // myChart.update();\n            for(k=0; k<msg.payload.data0.length; k++) {\n              myChart.data.datasets[0].data.push( msg.payload.data0[k] );\n            }\n            myChart.update();\n        }        \n        \n        //myChart.data.datasets[1].data.push( dati1 );\n        if( msg.payload.data1.length > 0  ) {\n            for(k=0; k<msg.payload.data1.length; k++) {\n              myChart.data.datasets[1].data.pop();\n            }\n           // myChart.update();\n            for(k=0; k<msg.payload.data1.length; k++) {\n              myChart.data.datasets[1].data.push( msg.payload.data1[k] );\n            }\n            myChart.update();\n        }\n        \n        \n        // and update chart\n       // myChart.update();\n        \n    }\n    \n    (function(scope) {\n        // this code gets run when the a view is opened on the node in the browser\n        scope.$watch('msg', function(msg) {\n            if (msg) {\n                doChart(msg, scope);\n            }\n        });\n    })(scope);    \n    \n})();\n</script>\n",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 720,
        "y": 1540,
        "wires": [
            []
        ],
        "info": "decimals in tooltips:\nhttps://social.msdn.microsoft.com/Forums/en-US/64911138-1dad-4534-ad07-e789f4550d56/chartjs-plot-decimal-points"
    },
    {
        "id": "7c4fd6f05725eb35",
        "type": "ui_template",
        "z": "1471bcf322cb6423",
        "group": "5f88817443cb3d4b",
        "name": "Velocità",
        "order": 7,
        "width": 8,
        "height": 5,
        "format": "<canvas id=\"SpeedChart\" width=\"300\" height=\"170\" style=\"border:1px solid #000000;margin: 2px;\"></canvas>\n\n<script>\n(function() {\n    var chartID = \"SpeedChart\";           // set this to the id you have specified in the canvas tag above\n\n    // setup the chart definition as defined in the chart.js documentation, \n    // in addition setting up the topic for each channel\n    var chartDef = {\n        type: 'scatter',\n        data: {\n          datasets: [\n            {\n              label: \"\",\n              fill: false,\n              pointStyle: 'rectRot',\n              pointRadius: 2,\n              lineTension: 0,\n              pointBackgroundColor: \"rgb(220, 0, 0)\",\n              borderColor: 'rgb(255, 0, 0)',\n              data: []  // data is written here later\n            },\n            {\n              label: \"\",\n              fill: false,\n              pointStyle: 'circle',\n              pointRadius: 2,\n              lineTension: 0,\n              pointBackgroundColor: \"rgb(0, 153, 255)\",\n              borderColor: 'rgb(0, 153, 255)',\n              data: []  // data is written here later\n            }        \n          ]\n        }, \n        options: {\n            animation: false,\n            fill: false,\n            tooltips: {\n                callbacks: {\n                    label: function (tooltipItem, data) {\n                        return Number(tooltipItem.xLabel).toFixed(2) +\"s, \" + Number(tooltipItem.yLabel).toFixed(3) + \"V\";\n                    }\n                }\n            },\n            legend: {\n                display: true,\n                labels: {\n                    fontColor: '#444'\n                }\n            },\n            layout: {\n                    padding: 10\n            },    \n            title: {\n                text: 'Velocità',\n                display: true,\n                fontColor: '#444'\n            }, \n            scales: {\n                xAxes: [{ \n                  scaleLabel: {\n                    display: true,\n                    fontColor: '#444',\n                    labelString: \"t [s]\"\n                  },\n                  ticks: {min: 0, max:0.5, tickStep: 0.1}\n                }],            \n                yAxes: [{ \n                  scaleLabel: {\n                    display: true,\n                    fontColor: '#444',\n                    labelString: \"Ampiezza [V]\"\n                  },\n                  ticks: {min: 0, max:3}\n                }]\n            }\n        }\n    };\n    \n    var myChart = null;\n    \n    function doChart(msg, scope) {\n        //var title = msg.payload.title;\n        var title = msg.payload.legend1;\n        \n        console.log(\"data 0:\");\n        console.log(msg.payload.data0);\n        if( msg.payload.data1.length > 0  ) {\n        console.log(\"data 1:\");\n        console.log(msg.payload.data1);\n        }\n        \n        if (!myChart) {\n            // chart does not exist so load the data and create it\n            var ctx = document.getElementById(chartID);\n            myChart = new Chart(ctx, chartDef); \n            \n            myChart.options.title.text = msg.payload.title;\n            \n            myChart.data.datasets[0].label = msg.payload.legend0;\n            myChart.data.datasets[1].label = msg.payload.legend1;\n        }\n\n\n        if( msg.payload.data0.length > 0  ) {\n            for(k=0; k<msg.payload.data0.length; k++) {\n              myChart.data.datasets[0].data.pop();\n            }\n           // myChart.update();\n            for(k=0; k<msg.payload.data0.length; k++) {\n              myChart.data.datasets[0].data.push( msg.payload.data0[k] );\n            }\n            myChart.update();\n        }        \n        \n        //myChart.data.datasets[1].data.push( dati1 );\n        if( msg.payload.data1.length > 0  ) {\n            for(k=0; k<msg.payload.data1.length; k++) {\n              myChart.data.datasets[1].data.pop();\n            }\n           // myChart.update();\n            for(k=0; k<msg.payload.data1.length; k++) {\n              myChart.data.datasets[1].data.push( msg.payload.data1[k] );\n            }\n            myChart.update();\n        }\n        \n        \n        // and update chart\n       // myChart.update();\n        \n    }\n    \n    (function(scope) {\n        // this code gets run when the a view is opened on the node in the browser\n        scope.$watch('msg', function(msg) {\n            if (msg) {\n                doChart(msg, scope);\n            }\n        });\n    })(scope);    \n    \n})();\n</script>\n",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 720,
        "y": 1600,
        "wires": [
            []
        ],
        "info": "decimals in tooltips:\nhttps://social.msdn.microsoft.com/Forums/en-US/64911138-1dad-4534-ad07-e789f4550d56/chartjs-plot-decimal-points"
    },
    {
        "id": "b98609121ba95407",
        "type": "debug",
        "z": "1471bcf322cb6423",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 430,
        "y": 1480,
        "wires": []
    },
    {
        "id": "d250054b5d0d87c6",
        "type": "debug",
        "z": "1471bcf322cb6423",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 550,
        "y": 340,
        "wires": []
    },
    {
        "id": "5f277d3547a97f14",
        "type": "ui_dropdown",
        "z": "1471bcf322cb6423",
        "name": "",
        "label": "Guadagno PGA",
        "tooltip": "",
        "place": "Select option",
        "group": "5f88817443cb3d4b",
        "order": 11,
        "width": 4,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "x1",
                "value": "0",
                "type": "str"
            },
            {
                "label": "x2",
                "value": "1",
                "type": "str"
            },
            {
                "label": "x4",
                "value": "2",
                "type": "str"
            },
            {
                "label": "x5",
                "value": "3",
                "type": "str"
            },
            {
                "label": "x8",
                "value": "4",
                "type": "str"
            },
            {
                "label": "x10",
                "value": "5",
                "type": "str"
            },
            {
                "label": "x16",
                "value": "6",
                "type": "str"
            },
            {
                "label": "x32",
                "value": "7",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "payload",
        "topicType": "msg",
        "className": "",
        "x": 420,
        "y": 1720,
        "wires": [
            [
                "7a8daf8d39b0f590"
            ]
        ]
    },
    {
        "id": "33f1d47d94108a8f",
        "type": "inject",
        "z": "1471bcf322cb6423",
        "name": "preset PGA",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "0",
        "payloadType": "str",
        "x": 140,
        "y": 1720,
        "wires": [
            [
                "5f277d3547a97f14"
            ]
        ]
    },
    {
        "id": "0f7909797d72a62f",
        "type": "debug",
        "z": "1471bcf322cb6423",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 830,
        "y": 1720,
        "wires": []
    },
    {
        "id": "2d7c46af8b409f68",
        "type": "mqtt out",
        "z": "1471bcf322cb6423",
        "name": "PGA set gain",
        "topic": "ESP32DevKit123/pgaSetGain",
        "qos": "0",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "35a4e7d1.620608",
        "x": 830,
        "y": 1780,
        "wires": []
    },
    {
        "id": "57f5080ca15c97a7",
        "type": "mqtt in",
        "z": "1471bcf322cb6423",
        "name": "",
        "topic": "ESP32DevKit123/pgaGetGain",
        "qos": "0",
        "datatype": "utf8",
        "broker": "35a4e7d1.620608",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 160,
        "y": 1820,
        "wires": [
            [
                "5f277d3547a97f14"
            ]
        ]
    },
    {
        "id": "7a8daf8d39b0f590",
        "type": "function",
        "z": "1471bcf322cb6423",
        "name": "",
        "func": "msg.topic = \"ESP32DevKit123/pgaSetGain\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 1720,
        "wires": [
            [
                "0f7909797d72a62f",
                "2d7c46af8b409f68"
            ]
        ]
    },
    {
        "id": "0214887e1b16ab8e",
        "type": "debug",
        "z": "1471bcf322cb6423",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 550,
        "y": 600,
        "wires": []
    }
]